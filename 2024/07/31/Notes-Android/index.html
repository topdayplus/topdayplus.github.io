<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css" integrity="sha256-xejo6yLi6vGtAjcMIsY8BHdKsLg7QynVlFMzdQgUuy8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"topdayplus.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.12.3","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="就这样吧">
<meta property="og:type" content="article">
<meta property="og:title" content="Notes-Android">
<meta property="og:url" content="http://topdayplus.github.io/2024/07/31/Notes-Android/index.html">
<meta property="og:site_name" content="Topday&#39;s Blog">
<meta property="og:description" content="就这样吧">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://topdayplus.github.io/2024/07/31/Notes-Android/01.png">
<meta property="og:image" content="http://topdayplus.github.io/2024/07/31/Notes-Android/02.png">
<meta property="og:image" content="http://topdayplus.github.io/2024/07/31/Notes-Android/03.png">
<meta property="og:image" content="http://topdayplus.github.io/2024/07/31/Notes-Android/05.png">
<meta property="og:image" content="http://topdayplus.github.io/2024/07/31/Notes-Android/04.png">
<meta property="og:image" content="http://topdayplus.github.io/2024/07/31/Notes-Android/06.png">
<meta property="og:image" content="http://topdayplus.github.io/2024/07/31/Notes-Android/07.png">
<meta property="og:image" content="http://topdayplus.github.io/2024/07/31/Notes-Android/08.png">
<meta property="article:published_time" content="2024-07-31T11:47:20.000Z">
<meta property="article:modified_time" content="2025-07-08T15:14:24.745Z">
<meta property="article:author" content="Topday">
<meta property="article:tag" content="Android">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://topdayplus.github.io/2024/07/31/Notes-Android/01.png">


<link rel="canonical" href="http://topdayplus.github.io/2024/07/31/Notes-Android/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://topdayplus.github.io/2024/07/31/Notes-Android/","path":"2024/07/31/Notes-Android/","title":"Notes-Android"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Notes-Android | Topday's Blog</title>
  






  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Topday's Blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80"><span class="nav-number">1.</span> <span class="nav-text">基础</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%80%86%E5%90%91%E7%8E%AF%E5%A2%83-amp-%E5%AE%89%E5%8D%93%E5%9F%BA%E7%A1%80"><span class="nav-number">2.</span> <span class="nav-text">逆向环境 &amp; 安卓基础</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#LSPosed"><span class="nav-number">3.</span> <span class="nav-text">LSPosed</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Hook-%E7%B1%BB%E7%9A%84%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95"><span class="nav-number">3.1.</span> <span class="nav-text">Hook 类的构造方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hook-%E7%B1%BB%E7%9A%84%E6%99%AE%E9%80%9A%E6%96%B9%E6%B3%95"><span class="nav-number">3.2.</span> <span class="nav-text">Hook 类的普通方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hook-%E7%B1%BB%E7%9A%84%E5%86%85%E9%83%A8%E7%B1%BB%E7%9A%84%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95"><span class="nav-number">3.3.</span> <span class="nav-text">Hook 类的内部类的构造方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hook-%E7%B1%BB%E7%9A%84%E5%86%85%E9%83%A8%E5%8C%BF%E5%90%8D%E7%B1%BB"><span class="nav-number">3.4.</span> <span class="nav-text">Hook 类的内部匿名类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hook-%E7%B1%BB%E7%9A%84%E6%99%AE%E9%80%9A%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F"><span class="nav-number">3.5.</span> <span class="nav-text">Hook 类的普通成员变量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hook-%E7%B1%BB%E7%9A%84%E9%9D%99%E6%80%81%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F-java%E5%8F%8D%E5%B0%84"><span class="nav-number">3.6.</span> <span class="nav-text">Hook 类的静态成员变量(java反射)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hook-%E7%B1%BB%E7%9A%84%E7%B1%BB%E5%8F%82%E6%95%B0%E7%9A%84%E6%99%AE%E9%80%9A%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F"><span class="nav-number">3.7.</span> <span class="nav-text">Hook 类的类参数的普通成员变量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hook-%E7%B1%BB%E7%9A%84%E5%8C%BF%E5%90%8D%E7%B1%BB%E7%9A%84%E6%99%AE%E9%80%9A%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F"><span class="nav-number">3.8.</span> <span class="nav-text">Hook 类的匿名类的普通成员变量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hook-%E5%86%85%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8%E6%96%B9%E6%B3%95"><span class="nav-number">3.9.</span> <span class="nav-text">Hook 内主动调用方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#hookAllMethods-amp-hookMethod"><span class="nav-number">3.10.</span> <span class="nav-text">hookAllMethods &amp; hookMethod</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A0%E5%A3%B3-x2F-%E5%A4%9Adex%E5%AF%BC%E8%87%B4%E6%89%BE%E4%B8%8D%E5%88%B0%E7%B1%BB"><span class="nav-number">3.11.</span> <span class="nav-text">加壳 &#x2F; 多dex导致找不到类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hook-native%EF%BC%88Dobby-%EF%BC%89"><span class="nav-number">3.12.</span> <span class="nav-text">Hook native（Dobby ）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B1%BB%E5%86%85%E6%9C%89%E7%89%B9%E6%AE%8A%E5%8F%82%E6%95%B0"><span class="nav-number">3.13.</span> <span class="nav-text">类内有特殊参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#lspatch-shizuku-%E5%AE%9E%E7%8E%B0-Hook"><span class="nav-number">3.14.</span> <span class="nav-text">lspatch+shizuku 实现 Hook</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#XPosed%E8%B0%83%E8%AF%95%E6%B5%81%E7%A8%8B"><span class="nav-number">3.14.1.</span> <span class="nav-text">XPosed调试流程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hook-%E4%BB%A3%E7%A0%81%E4%BA%A4%E4%BA%92"><span class="nav-number">3.15.</span> <span class="nav-text">Hook 代码交互</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#frida"><span class="nav-number">4.</span> <span class="nav-text">frida</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80-1"><span class="nav-number">4.1.</span> <span class="nav-text">基础</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#LSPosed-%E5%92%8C-Frida-hook-%E6%B5%81%E7%A8%8B"><span class="nav-number">4.2.</span> <span class="nav-text">LSPosed 和 Frida hook 流程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E4%BF%AE%E6%94%B9%E5%8F%82%E6%95%B0-x2F-%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="nav-number">4.3.</span> <span class="nav-text">查看修改参数&#x2F;返回值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8%E9%9D%99%E6%80%81%E3%80%81%E6%99%AE%E9%80%9A%E5%87%BD%E6%95%B0%E3%80%81%E5%86%85%E9%83%A8%E7%B1%BB%E3%80%81%E5%8C%BF%E5%90%8D%E7%B1%BB"><span class="nav-number">4.4.</span> <span class="nav-text">主动调用静态、普通函数、内部类、匿名类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%89%B9%E6%AE%8A%E5%8F%82%E6%95%B0%E6%89%93%E5%8D%B0"><span class="nav-number">4.5.</span> <span class="nav-text">特殊参数打印</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BF%E9%97%AE%E9%9D%99%E6%80%81%E5%B1%9E%E6%80%A7"><span class="nav-number">4.6.</span> <span class="nav-text">访问静态属性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%81%8D%E5%8E%86%E6%8C%87%E5%AE%9A%E7%B1%BB%E7%9A%84%E6%89%80%E6%9C%89%E6%96%B9%E6%B3%95"><span class="nav-number">4.7.</span> <span class="nav-text">遍历指定类的所有方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#frida-%E9%9B%86%E6%88%90%E5%B7%A5%E5%85%B7-%E2%80%94%E2%80%94-objection"><span class="nav-number">4.8.</span> <span class="nav-text">frida 集成工具 —— objection</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E6%9F%A5%E6%89%BE%E5%8C%85%E5%90%8D-x2F-%E5%BA%94%E7%94%A8ID-x2F-PID"><span class="nav-number">4.8.1.</span> <span class="nav-text">1、查找包名 &#x2F; 应用ID &#x2F; PID</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E6%8C%87%E5%AE%9A%E5%8C%85%E5%90%8D-x2F-%E5%BA%94%E7%94%A8ID-x2F-PID"><span class="nav-number">4.8.2.</span> <span class="nav-text">2、指定包名 &#x2F; 应用ID &#x2F; PID</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">4.8.3.</span> <span class="nav-text">3、常用命令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Wallbreak"><span class="nav-number">4.9.</span> <span class="nav-text">Wallbreak</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E6%88%98-1"><span class="nav-number">4.10.</span> <span class="nav-text">实战 1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hook-%E7%B3%BB%E7%BB%9FSO-amp-%E9%9D%99%E6%80%81%E6%B3%A8%E5%86%8CSO%E5%87%BD%E6%95%B0"><span class="nav-number">4.11.</span> <span class="nav-text">Hook 系统SO &amp; 静态注册SO函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hook-%E5%8A%A8%E6%80%81%E6%B3%A8%E5%86%8CSO%E5%87%BD%E6%95%B0%EF%BC%9A"><span class="nav-number">4.12.</span> <span class="nav-text">Hook 动态注册SO函数：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RPC-%E5%BC%80%E6%94%BE%E8%B0%83%E7%94%A8Java%E5%B1%82%E5%92%8CSO%E5%B1%82%E5%87%BD%E6%95%B0"><span class="nav-number">4.13.</span> <span class="nav-text">RPC 开放调用Java层和SO层函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hook-interface%E6%8E%A5%E5%8F%A3"><span class="nav-number">4.14.</span> <span class="nav-text">Hook interface接口</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95"><span class="nav-number">5.</span> <span class="nav-text">加密算法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#URLTOHEX"><span class="nav-number">5.1.</span> <span class="nav-text">URLTOHEX</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Base64"><span class="nav-number">5.2.</span> <span class="nav-text">Base64</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B6%88%E6%81%AF%E6%91%98%E8%A6%81%E7%AE%97%E6%B3%95"><span class="nav-number">5.3.</span> <span class="nav-text">消息摘要算法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95-amp-%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95"><span class="nav-number">5.4.</span> <span class="nav-text">对称加密算法 &amp; 非对称加密算法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E4%B9%B1%E4%B8%83%E5%85%AB%E7%B3%9F%E7%9A%84"><span class="nav-number">5.5.</span> <span class="nav-text">其他乱七八糟的</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8A%93%E5%8F%96%E6%B5%B7%E5%A4%96app%E7%9A%84%E5%8C%85"><span class="nav-number">6.</span> <span class="nav-text">抓取海外app的包</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#xBox-%E7%AE%97%E6%B3%95%E8%BF%98%E5%8E%9F"><span class="nav-number">6.0.1.</span> <span class="nav-text">xBox  算法还原</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PANDA-8-33-0-%E7%AE%97%E6%B3%95%E8%BF%98%E5%8E%9F"><span class="nav-number">6.0.2.</span> <span class="nav-text">PANDA(8.33.0) 算法还原</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#xliji-%E7%AE%97%E6%B3%95%E8%BF%98%E5%8E%9F"><span class="nav-number">6.0.3.</span> <span class="nav-text">xliji  算法还原</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%B7%E6%B1%82%E5%86%85%E5%AE%B9%E5%92%8C%E5%93%8D%E5%BA%94%E5%86%85%E5%AE%B9%E5%8A%A0%E5%AF%86"><span class="nav-number">6.0.4.</span> <span class="nav-text">请求内容和响应内容加密</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%B7%E6%B1%82%E5%86%85%E5%AE%B9%E5%92%8C%E8%BF%94%E5%9B%9E%E5%80%BC%E4%B9%B1%E7%A0%81"><span class="nav-number">6.0.5.</span> <span class="nav-text">请求内容和返回值乱码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8A%A0%E5%AF%86"><span class="nav-number">6.0.5.1.</span> <span class="nav-text">加密</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%A3%E5%AF%86"><span class="nav-number">6.0.5.2.</span> <span class="nav-text">解密</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Charles-%E6%8A%93%E5%8C%85%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB"><span class="nav-number">6.0.6.</span> <span class="nav-text">Charles 抓包问题汇总</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Topday"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">Topday</p>
  <div class="site-description" itemprop="description">For me, it has not yet been realized what the rest of one’s life, is my greatest encouragement.</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">23</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/topdayplus" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;topdayplus" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://topdayplus.github.io/2024/07/31/Notes-Android/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Topday">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Topday's Blog">
      <meta itemprop="description" content="For me, it has not yet been realized what the rest of one’s life, is my greatest encouragement.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Notes-Android | Topday's Blog">
      <meta itemprop="description" content="就这样吧">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Notes-Android
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
  
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-07-31 19:47:20" itemprop="dateCreated datePublished" datetime="2024-07-31T19:47:20+08:00">2024-07-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-07-08 23:14:24" itemprop="dateModified" datetime="2025-07-08T23:14:24+08:00">2025-07-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%81%B0%E9%98%9F/" itemprop="url" rel="index"><span itemprop="name">灰队</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>67k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1:01</span>
    </span>
</div>

            <div class="post-description">就这样吧</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h1><p>1、配置 ubutnu 模拟器环境</p>
<p>​	AS+genymotion 配置（396kyzdwPwp6b7A）</p>
<p>​	2、手机&#x2F;模拟器连接</p>
<p>1、USB线连接</p>
<p>2、wifi线，需要桥接，同一个网段，真机需要 root，打开开发者模式和USB调试</p>
<p>手残，在物理机开雷电模拟器，ubuntu的AS连接（要装ARM吗）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">在ubuntu上，用AS的adb执行</span><br><span class="line">adb connect 192.168.3.175:5555</span><br><span class="line">adb disconnect ip:5555</span><br><span class="line"></span><br><span class="line">adb -s 设备名称 //多个设备连接</span><br></pre></td></tr></table></figure>

<p>基础语法自己看去教程</p>
<p>四大组件：活动(activity)、意图(Intent)、广播、服务(Service)</p>
<ul>
<li>活动(activity) -&gt; 意图(Intent) -&gt;活动(activity)</li>
<li>服务(Service)：安卓保活</li>
<li>网络通信——HttpURLConnectio_okhttp</li>
<li>JNI<ul>
<li>让 Java 调用 C 语言或者 C++代码，让 C 调用 Java 代码</li>
</ul>
</li>
<li>NDK<ul>
<li>Android 的开发包，用于开发 C &#x2F; C++的动态库，编译成 &#x2F;so文件供 Java 调用，支持打包成 apk。NDK（Native Development Kit）是一套用于开发Android应用程序的工具集，它允许您在C&#x2F;C++中编写性能关键的部分代码，并将这些代码与Java代码进行连接。</li>
</ul>
</li>
<li>实战<ul>
<li>创建 Native 包</li>
<li>下载 NDK，CMake</li>
</ul>
</li>
</ul>
<p>参考资料：安卓逆向这档事</p>
<p><a target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-1787667-1-1.html">https://www.52pojie.cn/thread-1787667-1-1.html</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MainActivity.java</span></span><br><span class="line"><span class="comment">// 启动这个 java 代码，主要逻辑在 cpp 里，cpp代码也可以重新修改 java </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;native&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        Log.d(<span class="string">&quot;topday&quot;</span>,setMySonName(<span class="string">&quot;topday&quot;</span>));</span><br><span class="line">        sayHello(<span class="string">&quot;topday&quot;</span>);</span><br><span class="line">        Log.d(<span class="string">&quot;topday&quot;</span>,<span class="string">&quot;加法&quot;</span>+add(<span class="number">1</span>,<span class="number">2</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">native</span> String <span class="title function_">setMySonName</span><span class="params">(String name)</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">(String speak)</span>;</span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">native</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span></span><br><span class="line"><span class="comment">// 此处静态注册方法，长的方法名</span></span><br><span class="line"><span class="function">JNIEXPORT jstring JNICALL</span></span><br><span class="line"><span class="function"><span class="title">Java_com_example_lesson16_MainActivity_setMySonName</span><span class="params">(JNIEnv *env, jobject thiz, jstring name)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> implement setMySonName()</span></span><br><span class="line">    <span class="built_in">LOGE</span>(<span class="string">&quot;我是来自Java层的 -&gt;%s&quot;</span>,env-&gt;<span class="built_in">GetStringUTFChars</span>(name, JNI_FALSE));</span><br><span class="line">    std::string ss= <span class="string">&quot;topdayforjni&quot;</span>;</span><br><span class="line">    jstring  jstring1 = env-&gt;<span class="built_in">NewStringUTF</span>(ss.<span class="built_in">c_str</span>());</span><br><span class="line">    <span class="keyword">return</span> jstring1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 后续为动态注册</span></span><br><span class="line"><span class="comment">//public  native void sayHello(String speak);</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">sayHelloToJNI</span><span class="params">(JNIEnv *env, jobject thiz,jstring speak)</span></span>&#123;</span><br><span class="line">    <span class="built_in">LOGE</span>(<span class="string">&quot;我是来自Java层说话的的函数 -&gt;%s&quot;</span>,env-&gt;<span class="built_in">GetStringUTFChars</span>(speak, JNI_FALSE));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//public  native int sayNum(int i);</span></span><br><span class="line"><span class="function">jint <span class="title">addToJNI</span><span class="params">(JNIEnv *env, jobject thiz,jint a,jint b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a+b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> JNINativeMethod nativeMethod[] = &#123;</span><br><span class="line">        &#123;<span class="string">&quot;sayHello&quot;</span>,<span class="string">&quot;(Ljava/lang/String;)V&quot;</span>,(<span class="type">void</span>*)sayHelloToJNI&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;add&quot;</span>,<span class="string">&quot;(II)I&quot;</span>,(<span class="type">void</span>*)addToJNI&#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">jint <span class="title">JNI_OnLoad</span><span class="params">(JavaVM *vm,<span class="type">void</span> * reserved)</span></span>&#123;</span><br><span class="line">    <span class="comment">//初始化环境，每一个JNIEnv对应一个线程环境，且JNIEnv不能跨线程使用，如果想要在其他线程中使用JNIEnv则需要给当前线程附加JNIEnv环境</span></span><br><span class="line">    <span class="comment">//vm-&gt;AttachCurrentThread(&amp;env,0);//给当前线程附加JNIEnv环境</span></span><br><span class="line">    <span class="comment">//vm-&gt;DetachCurrentThread();//分离当前线程环境</span></span><br><span class="line">    JNIEnv *env = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//给JNIEnv环境赋值</span></span><br><span class="line">    <span class="keyword">if</span>(vm-&gt;<span class="built_in">GetEnv</span>((<span class="type">void</span>**)&amp;env,JNI_VERSION_1_4)!=JNI_OK)&#123;<span class="comment">//从JavaVM(java虚拟机)中获取线程的JNIEnv环境</span></span><br><span class="line">        <span class="keyword">return</span> JNI_FALSE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获取class对象，classPathName为java类的完整包名+类名</span></span><br><span class="line">    jclass clazz = env-&gt;<span class="built_in">FindClass</span>(<span class="string">&quot;com/example/test/MainActivity&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(clazz == <span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> JNI_FALSE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> result = env-&gt;<span class="built_in">RegisterNatives</span>(clazz,nativeMethod,<span class="built_in">sizeof</span>(nativeMethod) / <span class="built_in">sizeof</span> (nativeMethod[<span class="number">0</span>]));</span><br><span class="line">    <span class="comment">//注册Java方法和c++方法的映射关系</span></span><br><span class="line">    <span class="keyword">if</span>(result&lt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">LOGE</span>(<span class="string">&quot;方法映射失败&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> JNI_VERSION_1_4;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="逆向环境-amp-安卓基础"><a href="#逆向环境-amp-安卓基础" class="headerlink" title="逆向环境 &amp; 安卓基础"></a>逆向环境 &amp; 安卓基础</h1><p>真机还没到，先用模拟器+面具+lsp</p>
<ul>
<li>抓包 Charles<ul>
<li>导入证书，手动导入 &#x2F; chls.pro&#x2F;ssl</li>
<li>证书移动到系统目录，安装 Move_Certificates 模块，自动把证书移动到系统目录（雷电的 ROOT 怎么不稳定）</li>
</ul>
</li>
<li>数据加密原理<ul>
<li>浅析APP代理检测对抗 <a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/11398#toc-6">https://xz.aliyun.com/t/11398#toc-6</a></li>
</ul>
</li>
<li>安装 Postern<ul>
<li>HTTPS&#x3D; HTTP + SSL ，此处加密在 <strong>OSI 7层模型</strong> 的表示层</li>
<li>VPN 协议大多是作用在 OSI 的第二层和第三层之间。能抓到更多的流量</li>
<li>利用 Postern 转发本地 SOCKS5 流量到 Charles</li>
<li>手机请求 -&gt; Postern(手机代理) -&gt;charles -&gt; 主机代理(charles 本地) -&gt; 服务器</li>
</ul>
</li>
</ul>
<p>dex 文件就是字节码</p>
<ul>
<li>编译后的安卓程序代码文件</li>
<li>dex 反汇编后是 Smail 代码</li>
</ul>
<p>反汇编工具</p>
<ul>
<li>Jeb，带自动跳转，.&#x2F;jeb&#x2F;jeb_linux.sh</li>
</ul>
<p>基础语法</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41155858/article/details/127539649">https://blog.csdn.net/qq_41155858/article/details/127539649</a></li>
</ul>
<p>调试（Jeb 工具）</p>
<ul>
<li>setprop ro.debuggable 1</li>
<li>Jeb 工具，CTRL + B 下断点，Tab 跳转到反编译源码（Smail -&gt; Java）</li>
<li>点击 start 附加在运行的程序上</li>
<li>模拟器自带的 Dex 编辑器++能够直接重新打包</li>
</ul>
<h1 id="LSPosed"><a href="#LSPosed" class="headerlink" title="LSPosed"></a>LSPosed</h1><p>xposed -&gt; edxposed -&gt; lsposed</p>
<p>编写插件&#x2F;组件、便于 Hook 的框架</p>
<p>1、正常创建项目，导入 api-82 包</p>
<p>2、修改 compileOnly files(‘libs&#x2F;api-82.jar’)  &#x2F;&#x2F;只在编译时有效，不会参与打包</p>
<p>3、AndroidManifest.xml 新增模块</p>
<p>4、新建 assets 文件夹，指定 xposed_init 初始化模块</p>
<p>5、编写代码</p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-1740944-1-1.html">https://www.52pojie.cn/thread-1740944-1-1.html</a></p>
<p>原理：<a target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-1694093-1-1.html">https://www.52pojie.cn/thread-1694093-1-1.html</a></p>
<p>某手利用代理的方式还是抓不到评论</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">语法：</span><br><span class="line">1、正常类直接看案例</span><br><span class="line">2、jadx 可直接右键复制 xposed 代码，修改 classLoader，指定外部类</span><br><span class="line">3、匿名类，查看 Smail 语法，仿写 com.example.Hookdemo.Person$1</span><br></pre></td></tr></table></figure>

<img src="/2024/07/31/Notes-Android/01.png" class title="This is an example image">

<p>常用语法整理：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleLoadPackage</span><span class="params">(XC_LoadPackage.LoadPackageParam loadPackageParam)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="keyword">if</span>(!loadPackageParam.packageName.equals(<span class="string">&quot;com.example.hookdemo&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<h2 id="Hook-类的构造方法"><a href="#Hook-类的构造方法" class="headerlink" title="Hook 类的构造方法"></a>Hook 类的构造方法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 包名.类名，参数类型，构造方法的上层类就是 Person</span></span><br><span class="line">XposedHelpers.findAndHookConstructor(<span class="string">&quot;com.example.hookdemo.Person&quot;</span>, loadPackageParam.classLoader, String.class, <span class="type">int</span>.class, String.class, <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="built_in">super</span>.beforeHookedMethod(param);</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="built_in">super</span>.afterHookedMethod(param);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="Hook-类的普通方法"><a href="#Hook-类的普通方法" class="headerlink" title="Hook 类的普通方法"></a>Hook 类的普通方法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> loadPackageParam.classLoader;</span><br><span class="line">Class&lt;?&gt; clazz = classLoader.loadClass(<span class="string">&quot;com.example.hookdemo.Person&quot;</span>);</span><br><span class="line"></span><br><span class="line">XposedHelpers.findAndHookMethod(clazz, <span class="string">&quot;getName&quot;</span>, <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="built_in">super</span>.afterHookedMethod(param);</span><br><span class="line">		<span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="Hook-类的内部类的构造方法"><a href="#Hook-类的内部类的构造方法" class="headerlink" title="Hook 类的内部类的构造方法"></a>Hook 类的内部类的构造方法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> loadPackageParam.classLoader;</span><br><span class="line">Class&lt;?&gt; Person_clazz = classLoader.loadClass(<span class="string">&quot;com.example.hookdemo.Person&quot;</span>);</span><br><span class="line"><span class="comment">// jadx 可直接右键复制 xposed 代码，修改 classLoader，指定上层类</span></span><br><span class="line">XposedHelpers.findAndHookConstructor(<span class="string">&quot;com.example.hookdemo.Person$People&quot;</span>, Person_clazz.getClassLoader(), Person_clazz,String.class, <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="built_in">super</span>.beforeHookedMethod(param);</span><br><span class="line">        <span class="comment">// argument 1 has type com.example.hookdemo.Person</span></span><br><span class="line">        param.args[<span class="number">1</span>] = <span class="string">&quot;xxx&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="Hook-类的内部匿名类"><a href="#Hook-类的内部匿名类" class="headerlink" title="Hook 类的内部匿名类"></a>Hook 类的内部匿名类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 此处用 jadx 查看 Smail 语法，仿写，复制的不太准</span></span><br><span class="line">XposedHelpers.findAndHookMethod(<span class="string">&quot;com.example.hookdemo.Person$1&quot;</span>, loadPackageParam.classLoader, <span class="string">&quot;eatFunc&quot;</span>, String.class, <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="built_in">super</span>.beforeHookedMethod(param);</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="Hook-类的普通成员变量"><a href="#Hook-类的普通成员变量" class="headerlink" title="Hook 类的普通成员变量"></a>Hook 类的普通成员变量</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// private String name;</span></span><br><span class="line"><span class="comment">// 普通变量不能修改，只能获取初始值</span></span><br><span class="line"><span class="comment">// 获取普通属性就要实例化，staic属性不需要实例化</span></span><br><span class="line"><span class="comment">// 此处其实是 hook print 方法，内部逻辑获取成员变量</span></span><br><span class="line">XposedHelpers.findAndHookMethod(<span class="string">&quot;com.example.hookdemo.Person&quot;</span>, loadPackageParam.classLoader, <span class="string">&quot;print&quot;</span>, <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="built_in">super</span>.beforeHookedMethod(param);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//得到对象的两种方法</span></span><br><span class="line">        <span class="comment">//1.param.thisObject;</span></span><br><span class="line">        <span class="comment">//2.</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> loadPackageParam.classLoader;</span><br><span class="line">        Class&lt;?&gt; Person_clazz = classLoader.loadClass(<span class="string">&quot;com.example.hookdemo.Person&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 相当于 Person person = new Proson()</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj_person</span> <span class="operator">=</span> XposedHelpers.newInstance(Person_clazz);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取普通类的 非静态变量</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> (String) XposedHelpers.getObjectField(obj_person, <span class="string">&quot;name&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 修改静态成员才有效</span></span><br><span class="line">        <span class="comment">//XposedHelpers.setObjectField(obj_person,&quot;name&quot;,&quot;xxx&quot;);</span></span><br></pre></td></tr></table></figure>

<h2 id="Hook-类的静态成员变量-java反射"><a href="#Hook-类的静态成员变量-java反射" class="headerlink" title="Hook 类的静态成员变量(java反射)"></a>Hook 类的静态成员变量(java反射)</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取并修改普通类的 private static int age</span></span><br><span class="line"><span class="type">int</span> <span class="variable">xp_age</span> <span class="operator">=</span> XposedHelpers.getStaticIntField(Person_clazz, <span class="string">&quot;age&quot;</span>);</span><br><span class="line">Log.d(<span class="string">&quot;topday&quot;</span>,<span class="string">&quot;获取普通类的 private_age -&gt;&quot;</span>+xp_age);</span><br><span class="line">XposedHelpers.setStaticIntField(param.thisObject.getClass(),<span class="string">&quot;age&quot;</span>,<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取并修改普通类的   public static String address</span></span><br><span class="line"><span class="type">String</span> <span class="variable">xp_address</span> <span class="operator">=</span> (String) XposedHelpers.getStaticObjectField(param.thisObject.getClass(), <span class="string">&quot;address&quot;</span>);</span><br><span class="line">Log.d(<span class="string">&quot;topday&quot;</span>,<span class="string">&quot;获取普通类的 public static String -&gt;&quot;</span>+xp_address);</span><br><span class="line">XposedHelpers.setStaticObjectField(param.thisObject.getClass(),<span class="string">&quot;address&quot;</span>,<span class="string">&quot;M78星云&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//反射</span></span><br><span class="line"><span class="type">Field</span> <span class="variable">age_id</span> <span class="operator">=</span> param.thisObject.getClass().getDeclaredField(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">age_id.setAccessible(<span class="literal">true</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">age_int</span> <span class="operator">=</span> (<span class="type">int</span>)age_id.get(<span class="literal">null</span>);</span><br><span class="line">Log.d(<span class="string">&quot;xxx&quot;</span>,<span class="string">&quot;获取普通类的 private_age -&gt;&quot;</span>+age_int);</span><br><span class="line">age_id.set(<span class="literal">null</span>,<span class="number">100</span>);</span><br></pre></td></tr></table></figure>

<h2 id="Hook-类的类参数的普通成员变量"><a href="#Hook-类的类参数的普通成员变量" class="headerlink" title="Hook 类的类参数的普通成员变量"></a>Hook 类的类参数的普通成员变量</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实例化 Person 类的时候，类成员和匿名类同时也调用对应的构造函数</span></span><br><span class="line"><span class="comment">// 获取内部类的普通属性</span></span><br><span class="line"><span class="comment">// 获取普通属性就要实例化，staic属性不需要实例化</span></span><br><span class="line">Class&lt;?&gt; PeopleClass = Person_clazz.getClassLoader().loadClass(<span class="string">&quot;com.example.hookdemo.Person$People&quot;</span>);</span><br><span class="line"><span class="comment">// 相当于 Person.People people2 = new Person.People();</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">peoPleobject</span> <span class="operator">=</span> XposedHelpers.newInstance(PeopleClass, obj_person);</span><br><span class="line"><span class="type">String</span> <span class="variable">name1</span> <span class="operator">=</span> (String) XposedHelpers.getObjectField(peoPleobject, <span class="string">&quot;name&quot;</span>);</span><br><span class="line">Log.d(<span class="string">&quot;xxx&quot;</span>,<span class="string">&quot;获取内部类的普通属性 name -&gt;&quot;</span>+name1);</span><br></pre></td></tr></table></figure>

<h2 id="Hook-类的匿名类的普通成员变量"><a href="#Hook-类的匿名类的普通成员变量" class="headerlink" title="Hook 类的匿名类的普通成员变量"></a>Hook 类的匿名类的普通成员变量</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取匿名类的普通属性</span></span><br><span class="line"><span class="comment">// 获取普通属性就要实例化，staic属性不需要实例化</span></span><br><span class="line">Class&lt;?&gt; niminmgclass = XposedHelpers.findClass(<span class="string">&quot;com.example.hookdemo.Person$1&quot;</span>, Person_clazz.getClassLoader());</span><br><span class="line"><span class="comment">// 相当于 this.person1.nimingfangfa1();</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">nimingduixiang</span> <span class="operator">=</span> XposedHelpers.newInstance(niminmgclass, obj_person);</span><br><span class="line"><span class="type">int</span> <span class="variable">ceshi</span> <span class="operator">=</span> XposedHelpers.getIntField(nimingduixiang, <span class="string">&quot;ceshi&quot;</span>);</span><br><span class="line">Log.d(<span class="string">&quot;xxx&quot;</span>,<span class="string">&quot;获取匿名类的普通属性 ceshi -&gt;&quot;</span>+ceshi);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取并修改匿名类的静态属性</span></span><br><span class="line"><span class="type">int</span> <span class="variable">xp_anonymoutInt</span> <span class="operator">=</span> XposedHelpers.getStaticIntField(niminmgclass, <span class="string">&quot;anonymoutInt&quot;</span>);</span><br><span class="line">Log.d(<span class="string">&quot;xxx&quot;</span>,<span class="string">&quot;获取匿名类的静态属性 xp_anonymoutInt -&gt;&quot;</span>+xp_anonymoutInt);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改静态成员才有效</span></span><br><span class="line">XposedHelpers.setStaticIntField(niminmgclass,<span class="string">&quot;anonymoutInt&quot;</span>,<span class="number">666</span>);</span><br></pre></td></tr></table></figure>

<h2 id="Hook-内主动调用方法"><a href="#Hook-内主动调用方法" class="headerlink" title="Hook 内主动调用方法"></a>Hook 内主动调用方法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">XposedHelpers.findAndHookMethod(<span class="string">&quot;com.example.hookdemo.Person&quot;</span>, loadPackageParam.classLoader, <span class="string">&quot;print&quot;</span>, <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="built_in">super</span>.beforeHookedMethod(param);</span><br><span class="line"></span><br><span class="line">        Class&lt;?&gt; Person_clazz = XposedHelpers.findClass(<span class="string">&quot;com.example.hookdemo.Person&quot;</span>,loadPackageParam.classLoader);</span><br><span class="line">        <span class="comment">//非静态</span></span><br><span class="line">        XposedHelpers.callMethod(XposedHelpers.newInstance(Person_clazz),<span class="string">&quot;print&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="number">100</span>,<span class="string">&quot;2&quot;</span>);</span><br><span class="line">        <span class="comment">//静态的</span></span><br><span class="line">        XposedHelpers.callStaticMethod(Person_clazz,<span class="string">&quot;print&quot;</span>,<span class="string">&quot;李四&quot;</span>,<span class="number">99</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//内部类</span></span><br><span class="line">        Class&lt;?&gt; PeopleClass = Person_clazz.getClassLoader().loadClass(<span class="string">&quot;com.example.hookdemo.Person$People&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">peoPleobject</span> <span class="operator">=</span> XposedHelpers.newInstance(PeopleClass, XposedHelpers.newInstance(Person_clazz));</span><br><span class="line">        <span class="comment">//非静态</span></span><br><span class="line">        XposedHelpers.callMethod(peoPleobject,<span class="string">&quot;print&quot;</span>,<span class="string">&quot;1内部&quot;</span>,<span class="number">100</span>,<span class="string">&quot;2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="built_in">super</span>.afterHookedMethod(param);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="hookAllMethods-amp-hookMethod"><a href="#hookAllMethods-amp-hookMethod" class="headerlink" title="hookAllMethods &amp; hookMethod"></a>hookAllMethods &amp; hookMethod</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">hookAllMethods <span class="comment">// Hook所有同类方法（重载）</span></span><br><span class="line">hookMethod <span class="comment">// 替换</span></span><br><span class="line"></span><br><span class="line">Class&lt;?&gt; Person_clazz = XposedHelpers.findClass(<span class="string">&quot;com.example.hookdemo.Person&quot;</span>, loadPackageParam.classLoader);</span><br><span class="line"><span class="type">Method</span> <span class="variable">print_id</span> <span class="operator">=</span> Person_clazz.getDeclaredMethod(<span class="string">&quot;print&quot;</span>, String.class, <span class="type">int</span>.class);</span><br><span class="line"></span><br><span class="line">XposedBridge.hookMethod(print_id, <span class="keyword">new</span> <span class="title class_">XC_MethodReplacement</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">replaceHookedMethod</span><span class="params">(MethodHookParam methodHookParam)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        Log.d(<span class="string">&quot;topday&quot;</span>,<span class="string">&quot;两个参数 此函数已经被我替换了&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="加壳-x2F-多dex导致找不到类"><a href="#加壳-x2F-多dex导致找不到类" class="headerlink" title="加壳 &#x2F; 多dex导致找不到类"></a>加壳 &#x2F; 多dex导致找不到类</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">测试加固：</span><br><span class="line">1、app 签名</span><br><span class="line">2、上传到 360 加固</span><br><span class="line">3、MT 管理器实现签名</span><br><span class="line"></span><br><span class="line">hook attach</span><br><span class="line">attach:https://blog.csdn.net/caoshen2014/article/details/103341690</span><br></pre></td></tr></table></figure>

<img src="/2024/07/31/Notes-Android/02.png" class title="This is an example image">

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">XposedHelpers.findAndHookMethod(Application.class, <span class="string">&quot;attach&quot;</span>, Context.class, <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        ClassLoader cl= ((Context)param.args[<span class="number">0</span>]).getClassLoader();</span><br><span class="line">        Class&lt;?&gt; hookclass=<span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            hookclass=cl.loadClass(<span class="string">&quot;com.example.hookdemo.Person$People&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            Log.d(<span class="string">&quot;xxx&quot;</span>,<span class="string">&quot;未找到类&quot;</span>,e);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        XposedHelpers.findAndHookMethod(hookclass, <span class="string">&quot;print&quot;</span>, <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                Log.d(<span class="string">&quot;xxx&quot;</span>,<span class="string">&quot;hook打印&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<p>Tips：Xposed hook 在 java 层，SO 在 native 层，关键性能代码常在 native 层</p>
<h2 id="Hook-native（Dobby-）"><a href="#Hook-native（Dobby-）" class="headerlink" title="Hook native（Dobby ）"></a>Hook native（Dobby ）</h2><p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_56039202/article/details/128591978">https://blog.csdn.net/weixin_56039202/article/details/128591978</a></p>
<ul>
<li>xposed  写一个 so  注入器   </li>
<li>新建 native 项目，编写 Dobby 代码，编译出自己的 so 文件（提取 apk 的 so 文件，指定绝对地址）</li>
<li>把 so 放到指定目录</li>
<li>运行注入器</li>
</ul>
<h2 id="类内有特殊参数"><a href="#类内有特殊参数" class="headerlink" title="类内有特殊参数"></a>类内有特殊参数</h2><p><a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-215039.htm">https://bbs.kanxue.com/thread-215039.htm</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">用Xposed自身提供的XposedHelpers的findClass方法加载每一个类</span><br><span class="line"></span><br><span class="line">XposedHelpers.findClass  // 作为参数传入/实例化</span><br><span class="line">XposedHelpers.findAndHookMethod</span><br><span class="line"></span><br><span class="line">final Class&lt;?&gt; ArrayList= XposedHelpers.findClass(&quot;java.util.ArrayList&quot;, loadPackageParam.classLoader);</span><br><span class="line">final Class&lt;?&gt; Map= XposedHelpers.findClass(&quot;java.util.Map&quot;, loadPackageParam.classLoader);</span><br></pre></td></tr></table></figure>

<h2 id="lspatch-shizuku-实现-Hook"><a href="#lspatch-shizuku-实现-Hook" class="headerlink" title="lspatch+shizuku 实现 Hook"></a>lspatch+shizuku 实现 Hook</h2><ul>
<li>LSPosed框架的免 Root 实现</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://duzhaokun123.github.io/2022/05/06/simple-lspatch-guide.html">https://duzhaokun123.github.io/2022/05/06/simple-lspatch-guide.html</a></p>
<p>1、电脑运行命令激活 <code>Shizuku</code></p>
<p>2、<code>LSPatch</code> 显示 <code>Shizuku</code>服务可用</p>
<p>3、本地和打包运行（本机运行和单机运行）</p>
<h3 id="XPosed调试流程"><a href="#XPosed调试流程" class="headerlink" title="XPosed调试流程"></a>XPosed调试流程</h3><p>1、AS 编写 XPosed 代码，手机 ROOT，安装 LSP，通过 LSP 去指定模块、指定程序</p>
<p>2、免 ROOT 流程，激活 Shizuku，LSPatch 中 Shizuku 服务可用，在 LSPatch 中指定程序，运行后 LSPosed 脚本后，可在指定运行的模块。</p>
<h2 id="Hook-代码交互"><a href="#Hook-代码交互" class="headerlink" title="Hook 代码交互"></a>Hook 代码交互</h2><p><a target="_blank" rel="noopener" href="https://skyhand.blog.csdn.net/article/details/117674003">https://skyhand.blog.csdn.net/article/details/117674003</a></p>
<p><a target="_blank" rel="noopener" href="https://jasper1024.com/jasper/20220317024954/">https://jasper1024.com/jasper/20220317024954/</a></p>
<h1 id="frida"><a href="#frida" class="headerlink" title="frida"></a>frida</h1><h2 id="基础-1"><a href="#基础-1" class="headerlink" title="基础"></a>基础</h2><ul>
<li>firda-&gt;client 用 python安装即可，安装 frida-tools 自动安装 frida</li>
<li>firda 的版本随着 python，server 和 client 版本要对上</li>
<li>client -&gt;写代码端、server -&gt;接受代码执行</li>
<li>打开编辑器 code .</li>
<li>14.2.18</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">frida-ps的具体使用方法如下：  https://frida.re/docs/frida-trace/</span><br><span class="line"></span><br><span class="line">#连接到USB设备查看进程列表  frida-ps -U </span><br><span class="line">#连接到USB设备查看正在运行的应用  frida-ps -U -a </span><br><span class="line">#连接到USB设备查看所有安装的应用  frida-ps -U -a -i  </span><br><span class="line">#指定查看某个设备  frida-ps -D a666666 -a</span><br><span class="line"></span><br><span class="line">frida-trace -UF -j &#x27;*!*tesucanshu*&#x27;</span><br><span class="line"></span><br><span class="line">// 设备相关</span><br><span class="line">-D  连接到指定的设备，多个设备时使用。示例:frida-trace -D 555315d66cac2d5849408f53da9eea514a90547e -F </span><br><span class="line">-U  连接到USB设备，只有一个设备时使用。示例fria-trace -U -F</span><br><span class="line"></span><br><span class="line">// 应用程序相关</span><br><span class="line">-f  目标应用包名。spawn模式。示例:frida-trace -U -f com.apple.www</span><br><span class="line">-F  当前正在运行的程序。attach模式示例。示例:frida-trace -U -F或frida-trae -UF</span><br><span class="line">-n  正在运行的程序的名字。attach模式。示例:frida-trace -U -n QQ</span><br><span class="line">-N  正在运行的程序的包名。attach模式。示例:frida-trace -U -N com.apple.www</span><br><span class="line">-p  正在运行的程序的pid。attach模式。示例:frida-trace -U -p 2302</span><br><span class="line">  </span><br><span class="line">// 方法相关，以下参数在一条跟踪命令中可重复使用</span><br><span class="line">-I  包含模块。示例:frida-trace -UF -I &quot;libcommonCrypto*&quot;</span><br><span class="line">-X  不包含模块。示例:frida-trace -UF -X &quot;libcommonCrypto*&quot;</span><br><span class="line">-i   包含c函数。示例:frida-trace -UF -i &quot;strtsr&quot;</span><br><span class="line">-x   不包名c函数。示例:frida-trace -UF -i &quot;*MD5&quot; -x &quot;CC_MD5&quot;</span><br><span class="line">-a   包含模块+偏移跟踪。示例:frida-trace -UF -a 模块名\!0x7B7D48 </span><br><span class="line">-j  包含某个Java方法 实列frida-trace -UF  -j &#x27;*!*tesucanshu*/isu&#x27;</span><br><span class="line">	!用来分隔MODULE和OFFSET，例如&quot;gdi32full.dll!ExtTextOutW&quot;</span><br><span class="line">	*代表匹配任意内容</span><br><span class="line"></span><br><span class="line">-J  包含某个Java方法 实列frida-trace -UF  -J &#x27;*!*tesucanshu*/isu&#x27;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">// 日志相关</span><br><span class="line">-o  日志输出到文件。示例:frida-trace -UF -j &#x27;*!*tesucanshu*/isu&#x27; -o run.log</span><br></pre></td></tr></table></figure>



<h2 id="LSPosed-和-Frida-hook-流程"><a href="#LSPosed-和-Frida-hook-流程" class="headerlink" title="LSPosed 和 Frida hook 流程"></a>LSPosed 和 Frida hook 流程</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">LSPosed:</span><br><span class="line">1、安装面具(管理root权限和安装模块)、安装LSPosed（执行XPosed代码、指定程序、刷新需重启程序）</span><br><span class="line">2、之前案例是编写 java 代码，常用 findAndHookMethod，重写 beforeHookedMethod 和 afterHookedMethod</span><br><span class="line"></span><br><span class="line">Frida：</span><br><span class="line">1、服务端在 app 上启动，自动注入 hook 的启动程序</span><br><span class="line">2、客户端在主机启动，执行命令连接，而后编写 js 脚本进行 hook，动态刷新</span><br><span class="line">3、可注入当前运行程序 / 自选包名（Attach/Spwan）</span><br></pre></td></tr></table></figure>



<h2 id="查看修改参数-x2F-返回值"><a href="#查看修改参数-x2F-返回值" class="headerlink" title="查看修改参数&#x2F;返回值"></a>查看修改参数&#x2F;返回值</h2><blockquote>
<p>文档有许多的例子:因为frida 出来很久了所以百度会有许多他的案例</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/freeking101/article/details/112634649">https://blog.csdn.net/freeking101/article/details/112634649</a></p>
<p><a target="_blank" rel="noopener" href="https://kevinspider.github.io/frida/frida-hook-java/">https://kevinspider.github.io/frida/frida-hook-java/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/195869">https://www.anquanke.com/post/id/195869</a></p>
<p><a target="_blank" rel="noopener" href="https://frida.re/docs/examples/android/">https://frida.re/docs/examples/android/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/angelyan/p/16941444.html">https://www.cnblogs.com/angelyan/p/16941444.html</a>   常用frida hook - Maple_feng - 博客园</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">frida -U -f com.example.hookdemo -l lesson2.js --no-pause</span><br><span class="line">frida -UF -l lesson3.js</span><br><span class="line">Tip:</span><br><span class="line">1、HOOK默认是把对象hook没了，要主动返回或是继续操作（this/return）</span><br><span class="line">2、默认已连接adb的设备会自动连接frida服务端，只有一台的情况下</span><br><span class="line">3、雷电模拟器要下载x86_64版本</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title class_">Java</span>.<span class="property">available</span>)&#123;</span><br><span class="line">            <span class="comment">//执行hook代码</span></span><br><span class="line">            <span class="comment">// var person_class = Java.use(&quot;com.example.hookdemo.Person&quot;);</span></span><br><span class="line">            <span class="comment">// console.log(person_class);</span></span><br><span class="line">            <span class="comment">// person_class.$init.overload(&#x27;java.lang.String&#x27;, &#x27;int&#x27;, &#x27;java.lang.String&#x27;).implementation = function(a1,a2,a3)&#123;</span></span><br><span class="line">            <span class="comment">//     console.log(&quot;a1=&gt;&quot;+a1+&quot; &quot;+&quot;a2=&gt;&quot;+a2+&quot; &quot;+&quot;a3=&gt;&quot;+a3);</span></span><br><span class="line">            <span class="comment">//     var result = this.$init(&quot;fridaxxx&quot;,a2,a3)</span></span><br><span class="line">            <span class="comment">//     return result;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">            <span class="comment">// 查看并修改参数</span></span><br><span class="line">            <span class="keyword">let</span> <span class="title class_">Person</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.example.hookdemo.Person&quot;</span>);</span><br><span class="line">            <span class="title class_">Person</span>.<span class="property">setAddress</span>.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">address2</span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Person.setAddress is called: address2=<span class="subst">$&#123;address2&#125;</span>`</span>);</span><br><span class="line">                <span class="keyword">let</span> address = <span class="string">&quot;riben&quot;</span>;</span><br><span class="line">                <span class="variable language_">this</span>[<span class="string">&quot;setAddress&quot;</span>](address);</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="comment">// 查看并修改返回值</span></span><br><span class="line">            <span class="title class_">Person</span>[<span class="string">&quot;getName&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Person.getName is called`</span>);</span><br><span class="line">                <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;getName&quot;</span>]();</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Person.getName result=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;lisi&quot;</span>;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="comment">// 重载函数</span></span><br><span class="line">            <span class="title class_">Person</span>[<span class="string">&quot;print&quot;</span>].<span class="title function_">overload</span>(<span class="string">&#x27;java.lang.String&#x27;</span>, <span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;java.lang.String&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">a1,a2,a3</span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Person.print is called`</span>);</span><br><span class="line">                <span class="variable language_">this</span>[<span class="string">&quot;print&quot;</span>](a1,a2,a3);</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="title class_">Person</span>[<span class="string">&quot;print&quot;</span>].<span class="title function_">overload</span>(<span class="string">&#x27;java.lang.String&#x27;</span>, <span class="string">&#x27;int&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">a1,a2</span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Person.print is called`</span>,a1,a2);</span><br><span class="line">                <span class="variable language_">this</span>[<span class="string">&quot;print&quot;</span>](a1,a2);  </span><br><span class="line">            &#125;;  </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">setImmediate</span>(main); <span class="comment">//立即加载main函数</span></span><br><span class="line"><span class="comment">//setInterval(main,1000);//延时hook</span></span><br><span class="line"><span class="comment">//frida -U -f com.example.hookdemo -l lesson1.js </span></span><br></pre></td></tr></table></figure>



<h2 id="主动调用静态、普通函数、内部类、匿名类"><a href="#主动调用静态、普通函数、内部类、匿名类" class="headerlink" title="主动调用静态、普通函数、内部类、匿名类"></a>主动调用静态、普通函数、内部类、匿名类</h2><p>正式交付用 XPosed</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java.perform(function()&#123;</span></span><br><span class="line"><span class="comment">//     let AnonymousClass1 = Java.use(&quot;com.example.hookdemo.Person$1&quot;);</span></span><br><span class="line"><span class="comment">//     AnonymousClass1[&quot;eatFunc&quot;].implementation = function (value) &#123;</span></span><br><span class="line"><span class="comment">//         console.log(`AnonymousClass1.eatFunc is called: value=$&#123;value&#125;`);</span></span><br><span class="line"><span class="comment">//         this[&quot;eatFunc&quot;](value);</span></span><br><span class="line"><span class="comment">//     &#125;;</span></span><br><span class="line"><span class="comment">//     let People = Java.use(&quot;com.example.hookdemo.Person$People&quot;);</span></span><br><span class="line"><span class="comment">//     People[&quot;$init&quot;].overload(&#x27;com.example.hookdemo.Person&#x27;, &#x27;java.lang.String&#x27;).implementation = function (ins,name) &#123;</span></span><br><span class="line"><span class="comment">//         console.log(`People.$init is called: name=$&#123;name&#125;`);</span></span><br><span class="line"><span class="comment">//         this[&quot;$init&quot;](ins,name);</span></span><br><span class="line"><span class="comment">//     &#125;;</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//主动调用静态方法，jadx复制的默认是被动触发</span></span><br><span class="line">    <span class="comment">//    var perclass =  Java.use(&quot;com.example.hookdemo.Person&quot;);</span></span><br><span class="line">    <span class="comment">//    perclass.print(&quot;xxx&quot;,20);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//调用普通方法</span></span><br><span class="line">    <span class="comment">// var perclass =  Java.use(&quot;com.example.hookdemo.Person&quot;);</span></span><br><span class="line">    <span class="comment">// var perins = perclass.$new(&quot;xxx&quot;,20,&quot;zhongguo&quot;);</span></span><br><span class="line">    <span class="comment">// console.log(perins.getName());</span></span><br><span class="line">    <span class="comment">// perins.print();</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// //调用匿名类的方法</span></span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">AnonymousClass1</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.example.hookdemo.Person$1&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">AnonymousClass1</span>_ins = <span class="title class_">AnonymousClass1</span>.$new(perins); <span class="comment">// perins为默认传参</span></span><br><span class="line">    <span class="title class_">AnonymousClass1</span>_ins.<span class="title function_">eatFunc</span>(<span class="string">&quot;dayu&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// //调用内部类的方法</span></span><br><span class="line">    <span class="comment">// let People = Java.use(&quot;com.example.hookdemo.Person$People&quot;);</span></span><br><span class="line">    <span class="comment">// let People_ins = People.$new(perins,&quot;neibuxxx&quot;);</span></span><br><span class="line">    <span class="comment">// People_ins.print();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// var perclass =  Java.use(&quot;com.example.hookdemo.Person&quot;);</span></span><br><span class="line">    <span class="comment">// console.log(perclass.name.value);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态选择，运行中所有实例化过的都给匹配出来了</span></span><br><span class="line">    <span class="comment">// Java.choose(&quot;com.example.hookdemo.Person&quot;,&#123;</span></span><br><span class="line">    <span class="comment">//     onMatch:function(instance)&#123;</span></span><br><span class="line">    <span class="comment">//         console.log(instance.name.value);</span></span><br><span class="line">    <span class="comment">//         // instance.name.value = &quot;11111&quot;;</span></span><br><span class="line">    <span class="comment">//     &#125;,onComplete:function()&#123;</span></span><br><span class="line">    <span class="comment">//         console.log(&quot;end&quot;);</span></span><br><span class="line">    <span class="comment">//     &#125;</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ins.print();</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h2 id="特殊参数打印"><a href="#特殊参数打印" class="headerlink" title="特殊参数打印"></a>特殊参数打印</h2><p>记住几个，用到的时候去查</p>
<h2 id="访问静态属性"><a href="#访问静态属性" class="headerlink" title="访问静态属性"></a>访问静态属性</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> person_class = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.example.hookdemo.Person&quot;</span>);</span><br><span class="line">    <span class="comment">// console.log(person_class._print.value);  //属性名和方法名重复+_</span></span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">choose</span>(<span class="string">&quot;com.example.hookdemo.Person&quot;</span>,&#123;</span><br><span class="line">        <span class="attr">onMatch</span>:<span class="keyword">function</span>(<span class="params">instance</span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(instance)</span><br><span class="line">            instance.<span class="property">name</span>.<span class="property">value</span> = <span class="string">&quot;xiugainame&quot;</span>;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(instance.<span class="property">name</span>.<span class="property">value</span>);</span><br><span class="line">        &#125;,<span class="attr">onComplete</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;end&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)	</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h2 id="遍历指定类的所有方法"><a href="#遍历指定类的所有方法" class="headerlink" title="遍历指定类的所有方法"></a>遍历指定类的所有方法</h2><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/c9e6776516e8">https://www.jianshu.com/p/c9e6776516e8</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 此种方法会遍历重载、内部、get/set函数</span></span><br><span class="line"><span class="comment">// 理论是遍历已加载的类、但实际没实例化的都列出来了</span></span><br><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">enumerateLoadedClasses</span>(&#123;</span><br><span class="line">        <span class="attr">onMatch</span>:<span class="keyword">function</span>(<span class="params">name,handle</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(name.<span class="title function_">indexOf</span>(<span class="string">&quot;com.example.hookdemo.Person&quot;</span>)!=-<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="comment">// console.log(name,handle);</span></span><br><span class="line">                <span class="comment">// 得到class</span></span><br><span class="line">                <span class="keyword">var</span> <span class="title class_">TargetClass</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(name);</span><br><span class="line">                <span class="comment">// 得到方法数组</span></span><br><span class="line">                <span class="keyword">var</span> methods = <span class="title class_">TargetClass</span>.<span class="property">class</span>.<span class="title function_">getDeclaredMethods</span>();</span><br><span class="line">                <span class="comment">//遍历数组   进行hook</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;methods.<span class="property">length</span>;i++)&#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(methods[i].<span class="title function_">getName</span>())</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="attr">onComplete</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;serach end&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> classList = <span class="title class_">Java</span>.<span class="title function_">enumerateLoadedClassesSync</span>();</span><br><span class="line">    <span class="keyword">var</span> parsedMethods = [];</span><br><span class="line">    <span class="comment">// console.log(classList)</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; classList.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> targetClass = classList[i];</span><br><span class="line">        <span class="keyword">if</span> (targetClass == <span class="string">&quot;com.example.hookdemo.Person&quot;</span>) &#123;</span><br><span class="line">            <span class="comment">// 得到class</span></span><br><span class="line">            <span class="keyword">var</span> <span class="title class_">TargetClass</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(targetClass);</span><br><span class="line">            <span class="comment">// 得到方法数组</span></span><br><span class="line">            <span class="keyword">var</span> methods = <span class="title class_">TargetClass</span>.<span class="property">class</span>.<span class="title function_">getDeclaredMethods</span>();</span><br><span class="line">            <span class="comment">//遍历数组   进行hook</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; methods.<span class="property">length</span>; j++) &#123;</span><br><span class="line">                <span class="comment">// console.log(methods[j].getName())</span></span><br><span class="line">                <span class="keyword">var</span> methodName = methods[j].<span class="title function_">getName</span>();</span><br><span class="line">                parsedMethods.<span class="title function_">push</span>(methodName);</span><br><span class="line">                <span class="comment">// console.log(TargetClass, methodName, TargetClass[methodName].overloads.length);</span></span><br><span class="line">            &#125;</span><br><span class="line">            parsedMethods.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">targetMethod</span>) &#123;</span><br><span class="line">                <span class="comment">// traceMethod(TargetClass + &quot;.&quot; + targetMethod);</span></span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">TargetClass</span>, targetMethod);</span><br><span class="line">                <span class="comment">// 获取目标重载的方法数量</span></span><br><span class="line">                <span class="keyword">var</span> overloadCount = <span class="title class_">TargetClass</span>[targetMethod].<span class="property">overloads</span>.<span class="property">length</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> x = <span class="number">0</span>; x &lt; overloadCount; x++) &#123;</span><br><span class="line">                    <span class="title class_">TargetClass</span>[targetMethod].<span class="property">overloads</span>[x].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>, targetMethod);</span><br><span class="line">                        <span class="keyword">for</span> (<span class="keyword">var</span> a = <span class="number">0</span>; a &lt; <span class="variable language_">arguments</span>.<span class="property">length</span>; a++) &#123;</span><br><span class="line">                            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;arguments&#x27;</span>, a, <span class="variable language_">arguments</span>[a]);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">return</span> <span class="variable language_">this</span>[targetMethod].<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h2 id="frida-集成工具-——-objection"><a href="#frida-集成工具-——-objection" class="headerlink" title="frida 集成工具 —— objection"></a>frida 集成工具 —— objection</h2><p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/197657">https://www.anquanke.com/post/id/197657</a></p>
<p>1、集成各种常用 API，列出某个包的类&#x2F;方法等<br>2、启动前 frida 必须正常连接</p>
<p>运行步骤：</p>
<h3 id="1、查找包名-x2F-应用ID-x2F-PID"><a href="#1、查找包名-x2F-应用ID-x2F-PID" class="headerlink" title="1、查找包名 &#x2F; 应用ID &#x2F; PID"></a>1、查找包名 &#x2F; 应用ID &#x2F; PID</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 根据应用名查找包名</span><br><span class="line">frida-ps -U -a</span><br><span class="line">// 根据进程名查找包名</span><br><span class="line">frida-ps -U </span><br></pre></td></tr></table></figure>

<h3 id="2、指定包名-x2F-应用ID-x2F-PID"><a href="#2、指定包名-x2F-应用ID-x2F-PID" class="headerlink" title="2、指定包名 &#x2F; 应用ID &#x2F; PID"></a>2、指定包名 &#x2F; 应用ID &#x2F; PID</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">objection  --help 可以查看命令</span><br><span class="line">objection -g xxx/PID explore  </span><br><span class="line">	1.如果使用PID/应用名称   那就是attach模式</span><br><span class="line">	2.如果使用包名,那就是spwan模式,并且会帮助我们自动启动app</span><br><span class="line">	</span><br><span class="line">	-s &quot;命令&quot;</span><br><span class="line">	-c &quot;路径&quot;</span><br></pre></td></tr></table></figure>

<h3 id="3、常用命令"><a href="#3、常用命令" class="headerlink" title="3、常用命令"></a>3、常用命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">1.列出所有已加载的类:</span><br><span class="line">	android hooking list classes</span><br><span class="line"></span><br><span class="line">2.搜索关键字类</span><br><span class="line">	android hooking search classes MainActivity</span><br><span class="line">	</span><br><span class="line">3.列出类的所有方法</span><br><span class="line">	android hooking list class_methods com.example.hookdemo.MainActivity</span><br><span class="line">	</span><br><span class="line">4.hook方法  可以带上参数  返回值  调用栈，监控</span><br><span class="line">	android hooking watch class_method com.example.hookdemo.MainActivity.tesucanshu2 --dump-args --dump-return</span><br><span class="line">	</span><br><span class="line">5.hook类的所有方法</span><br><span class="line">	android hooking watch class com.example.hookdemo.MainActivity</span><br><span class="line"></span><br><span class="line">6.查看与取消hook</span><br><span class="line">	jobs list</span><br><span class="line">	jobs kill 049953</span><br><span class="line"></span><br><span class="line">7.搜索实列:</span><br><span class="line">	android heap search instances com.example.hookdemo.Person</span><br><span class="line"></span><br><span class="line">8.通过实例执行方法:</span><br><span class="line">	android heap execute 48164808 print</span><br><span class="line"></span><br><span class="line">9.进入编辑器环境</span><br><span class="line">	android heap evaluate 48164808</span><br><span class="line">	写代码:clazz.print()</span><br><span class="line">	esc 键退出环境,enter回车执行</span><br><span class="line">	</span><br><span class="line">	这个功能可以即时编写、出结果、即时调试自己的代码，不用再编写→注入→操作→看结果→再调整，而是直接出结果。</span><br><span class="line">	</span><br><span class="line">10.启动activity或service</span><br><span class="line">	查看可用的:android hooking list activities</span><br><span class="line">	启动:android intent launch_activity</span><br><span class="line">	</span><br><span class="line">	也可以先使用android hooking list services查看可供开启的服务，然后使用android intent launch_service 		com.android.settings.bluetooth.BluetoothPairingService命令来开启服务。</span><br><span class="line"></span><br><span class="line">11、枚举内存中的所有模块</span><br><span class="line">	memory list modules</span><br><span class="line"></span><br><span class="line">12、枚举模块中所有导出函数</span><br><span class="line">	memory list exports muyangdemo  --json 路径(结果太多时用)</span><br><span class="line">	</span><br></pre></td></tr></table></figure>



<h2 id="Wallbreak"><a href="#Wallbreak" class="headerlink" title="Wallbreak"></a>Wallbreak</h2><p>1、可集成在 objection 使用</p>
<p>2、用于快速分析 Java 类&#x2F;对象结构</p>
<p><a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-260110.htm">https://bbs.kanxue.com/thread-260110.htm</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/hluwa/Wallbreaker">https://github.com/hluwa/Wallbreaker</a></p>
<p>attach模式 ：Frida会附加app</p>
<p>Spawn模式：重新启动app</p>
<p>1、加载插件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plugin load &#x27;路径&#x27;</span><br></pre></td></tr></table></figure>

<p>2、执行命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">plugin wallbreaker classdump &#x27;类名&#x27;</span><br><span class="line">plugin wallbreaker classsearch &#x27;类名&#x27;</span><br><span class="line">plugin wallbreaker objectdump &#x27;对象名&#x27;</span><br><span class="line">plugin wallbreaker objectsearch &#x27;对象名&#x27;</span><br></pre></td></tr></table></figure>



<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">printStacks</span>(<span class="params">name</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;====== printStacks start ====== &quot;</span> + name + <span class="string">&quot;==============================&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// sample 1</span></span><br><span class="line">    <span class="keyword">var</span> throwable = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;android.util.Log&quot;</span>).<span class="title function_">getStackTraceString</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.Throwable&quot;</span>).$new());</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(throwable);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// // sample 2</span></span><br><span class="line">    <span class="comment">// var exception = Java.use(&quot;android.util.Log&quot;).getStackTraceString(Java.use(&quot;java.lang.Exception&quot;).$new());</span></span><br><span class="line">    <span class="comment">// console.log(exception);</span></span><br><span class="line">    </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;====== printStacks end ======== &quot;</span> + name + <span class="string">&quot;==============================&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> jclazz = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">var</span> jobj = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getObjClassName</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!jclazz) &#123;</span><br><span class="line">        <span class="keyword">var</span> jclazz = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.Class&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!jobj) &#123;</span><br><span class="line">        <span class="keyword">var</span> jobj = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.Object&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> jclazz.<span class="property">getName</span>.<span class="title function_">call</span>(jobj.<span class="property">getClass</span>.<span class="title function_">call</span>(obj));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">watch</span>(<span class="params">obj, mtdName</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> listener_name = <span class="title function_">getObjClassName</span>(obj);</span><br><span class="line">    <span class="keyword">var</span> target = <span class="title class_">Java</span>.<span class="title function_">use</span>(listener_name);</span><br><span class="line">    <span class="keyword">if</span> (!target || !mtdName <span class="keyword">in</span> target) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// send(&quot;[WatchEvent] hooking &quot; + mtdName + &quot;: &quot; + listener_name);</span></span><br><span class="line">    target[mtdName].<span class="property">overloads</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">overload</span>) &#123;</span><br><span class="line">        overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="comment">//send(&quot;[WatchEvent] &quot; + mtdName + &quot;: &quot; + getObjClassName(this));</span></span><br><span class="line">            <span class="title function_">printStacks</span>(<span class="string">&quot;WatchEvent&quot;</span>+mtdName)</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[WatchEvent] &quot;</span> + mtdName + <span class="string">&quot;: &quot;</span> + <span class="title function_">getObjClassName</span>(<span class="variable language_">this</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>[mtdName].<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">OnClickListener</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//以spawn启动进程的模式来attach的话</span></span><br><span class="line">        <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;android.view.View&quot;</span>).<span class="property">setOnClickListener</span>.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">listener</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (listener != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="title function_">watch</span>(listener, <span class="string">&#x27;onClick&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">setOnClickListener</span>(listener);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果frida以attach的模式进行attch的话</span></span><br><span class="line">        <span class="title class_">Java</span>.<span class="title function_">choose</span>(<span class="string">&quot;android.view.View$ListenerInfo&quot;</span>, &#123;</span><br><span class="line">            <span class="attr">onMatch</span>: <span class="keyword">function</span> (<span class="params">instance</span>) &#123;</span><br><span class="line">                instance = instance.<span class="property">mOnClickListener</span>.<span class="property">value</span>;</span><br><span class="line">                <span class="keyword">if</span> (instance) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;mOnClickListener name is :&quot;</span> + <span class="title function_">getObjClassName</span>(instance));</span><br><span class="line">                    <span class="title function_">watch</span>(instance, <span class="string">&#x27;onClick&#x27;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">onComplete</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">setImmediate</span>(<span class="title class_">OnClickListener</span>);</span><br></pre></td></tr></table></figure>



<h2 id="实战-1"><a href="#实战-1" class="headerlink" title="实战 1"></a>实战 1</h2><p><a target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-1446044-1-1.html">https://www.52pojie.cn/thread-1446044-1-1.html</a></p>
<p>手动思路：</p>
<p>1、反编译源码，通过apk按钮定位到触发的类，以及多个疑似触发方法</p>
<p>2、通过 wallbreak dump出触发时的内存变量，定位到具体的触发方法</p>
<p>3、审视代码，定位密码变量，直接在内存中看</p>
<p>遗留问题：</p>
<p>1、frida 的 hook setOnClickListener 脚本无法手动注入</p>
<p>2、扒第一关源码算法后，打印的值疑似加密，但代码逻辑无加密</p>
<p>坑点：</p>
<p>1、hook equals 到死</p>
<p>2、要用 –no-pause 以免程序暂停</p>
<p>3、编写算法时，类可能会在 onstart 等地方初始化，或是依托特有代码进行处理（用 sendEmptyMessage 发送。handleMessage中处理）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Str</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.String&quot;</span>);</span><br><span class="line">    <span class="title class_">Str</span>.<span class="property">equals</span>.<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">a1</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(a1);</span><br><span class="line">        <span class="keyword">var</span> re = <span class="variable language_">this</span>.<span class="title function_">equals</span>(a1);</span><br><span class="line">        <span class="keyword">return</span> re;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h2 id="Hook-系统SO-amp-静态注册SO函数"><a href="#Hook-系统SO-amp-静态注册SO函数" class="headerlink" title="Hook 系统SO &amp; 静态注册SO函数"></a>Hook 系统SO &amp; 静态注册SO函数</h2><p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/195215#h2-1">https://www.anquanke.com/post/id/195215#h2-1</a></p>
<p>Process &#x2F; Module &#x2F; Memory &#x2F; Interceptor.attach</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="variable language_">module</span> = <span class="title class_">Process</span>.<span class="title function_">findModuleByName</span>(<span class="string">&quot;libhookdemo.so&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> pattern  = <span class="string">&quot;55 41 57 41 56 41 55 41 54 53 48 83 EC 18 49 89 FE 48 BD EF FF FF FF FF FF FF 3F&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">module</span>.<span class="property">base</span>)</span><br><span class="line"><span class="title class_">Memory</span>.<span class="title function_">scan</span>(<span class="variable language_">module</span>.<span class="property">base</span>,<span class="variable language_">module</span>.<span class="property">size</span>,pattern,&#123;</span><br><span class="line">    <span class="attr">onMatch</span>:<span class="keyword">function</span>(<span class="params">address,size</span>)&#123;</span><br><span class="line">     <span class="comment">//搜索成功</span></span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;搜索到 &#x27;</span> +pattern +<span class="string">&quot; 地址是:&quot;</span>+ address.<span class="title function_">toString</span>());  </span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onError</span>:<span class="keyword">function</span>(<span class="params">resaon</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;搜索失败&quot;</span>,resaon);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onComplete</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;搜索完成&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定位并读取系统so</span></span><br><span class="line"><span class="keyword">var</span> pointer = <span class="title class_">Process</span>.<span class="title function_">findModuleByName</span>(<span class="string">&quot;libc.so&quot;</span>).<span class="property">base</span>; <span class="comment">//系统so</span></span><br><span class="line"><span class="keyword">const</span> r = <span class="title class_">Memory</span>.<span class="title function_">alloc</span>(<span class="number">0x10</span>);  <span class="comment">// 分配16个字节</span></span><br><span class="line">r.<span class="title function_">writePointer</span>(pointer);</span><br><span class="line"><span class="keyword">var</span> buffer = <span class="title class_">Memory</span>.<span class="title function_">readByteArray</span>(r, <span class="number">0x10</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义字符写入内存</span></span><br><span class="line"><span class="keyword">var</span> arr = [<span class="number">0x74</span>,<span class="number">0x65</span>,<span class="number">0x73</span>,<span class="number">0x74</span>];</span><br><span class="line"><span class="keyword">const</span> r = <span class="title class_">Memory</span>.<span class="title function_">alloc</span>(arr.<span class="property">length</span>);</span><br><span class="line"><span class="title class_">Memory</span>.<span class="title function_">writeByteArray</span>(r,arr);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;readCString():&quot;</span>+r.<span class="title function_">readCString</span>());</span><br><span class="line"><span class="keyword">const</span> newPtrstr = r.<span class="title function_">writeUtf8String</span>(<span class="string">&quot;haha&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;readCString():&quot;</span>+newPtrstr.<span class="title function_">readCString</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不确定so名，hook其中的导出函数</span></span><br><span class="line"><span class="keyword">var</span> arr = [<span class="number">0x74</span>,<span class="number">0x65</span>,<span class="number">0x73</span>,<span class="number">0x74</span>];</span><br><span class="line"><span class="keyword">var</span> funaddress = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="literal">null</span>,<span class="string">&quot;strstr&quot;</span>);</span><br><span class="line"><span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(funaddress,&#123;</span><br><span class="line">    <span class="attr">onEnter</span>:<span class="keyword">function</span>(<span class="params">args</span>)&#123;</span><br><span class="line">        <span class="comment">// console.log(args[0].readCString());</span></span><br><span class="line">        <span class="comment">// console.log(args[1].readCString());</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Context information:&#x27;</span>);</span><br><span class="line">        <span class="comment">//输出上下文因其是一个Objection对象，需要它进行接送、转换才能正常看到值</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Context  : &#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">context</span>));</span><br><span class="line">        <span class="comment">//输出返回地址</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Return   : &#x27;</span> + <span class="variable language_">this</span>.<span class="property">returnAddress</span>);</span><br><span class="line">        <span class="comment">//输出线程id</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ThreadId : &#x27;</span> + <span class="variable language_">this</span>.<span class="property">threadId</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Depth    : &#x27;</span> + <span class="variable language_">this</span>.<span class="property">depth</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Errornr  : &#x27;</span> + <span class="variable language_">this</span>.<span class="property">err</span>);</span><br><span class="line">    &#125;, <span class="attr">onLeave</span>: <span class="keyword">function</span> (<span class="params">retval</span>) &#123;</span><br><span class="line">        <span class="comment">// var r = Memory.alloc(0x16);</span></span><br><span class="line">        <span class="comment">// r.writeByteArray(arr);</span></span><br><span class="line">        <span class="comment">// retval.replace(r);</span></span><br><span class="line">        retval.<span class="title function_">replace</span>(<span class="number">0</span>);</span><br><span class="line">       &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// hook 自实现的静态so函数</span></span><br><span class="line"><span class="keyword">var</span> funaddress1 = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="string">&quot;libhookdemo.so&quot;</span>,<span class="string">&quot;Java_com_example_hookdemo_MainActivity_signatureTest&quot;</span>);</span><br><span class="line"><span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(funaddress1,&#123;</span><br><span class="line">    <span class="attr">onEnter</span>:<span class="keyword">function</span>(<span class="params">args</span>)&#123;</span><br><span class="line">        <span class="comment">// console.log(hexdump(args[0]));</span></span><br><span class="line">        <span class="keyword">var</span> env = <span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">getEnv</span>();</span><br><span class="line">        <span class="keyword">if</span>(env!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">var</span> canshu = env.<span class="title function_">getStringUtfChars</span>(args[<span class="number">2</span>],<span class="literal">false</span>); <span class="comment">//第几个参数可以ida看</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(canshu.<span class="title function_">readCString</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="attr">onLeave</span>: <span class="keyword">function</span> (<span class="params">retval</span>) &#123;</span><br><span class="line">        <span class="comment">// console.log(retval.readCString())</span></span><br><span class="line">        <span class="keyword">var</span> env = <span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">getEnv</span>();</span><br><span class="line">            <span class="keyword">if</span>(env!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">var</span> canshu = env.<span class="title function_">getStringUtfChars</span>(retval,<span class="literal">false</span>);</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(canshu.<span class="title function_">readCString</span>());</span><br><span class="line">            &#125;</span><br><span class="line">       &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主动调用自编写的某个so方法，inlinehook 任意函数，不知道具体函数名，根据地址去hook</span></span><br><span class="line"><span class="keyword">var</span> hookdemo_add = <span class="title class_">Module</span>.<span class="title function_">findBaseAddress</span>(<span class="string">&quot;libhookdemo.so&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> add_0D64 = hookdemo_add.<span class="title function_">add</span>(<span class="number">0x667A0</span>); <span class="comment">// 此处指定的是此方法在内存中执行首地址</span></span><br><span class="line"><span class="keyword">var</span> newaddString_func  = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(add_0D64,<span class="string">&quot;pointer&quot;</span>,[<span class="string">&#x27;pointer&#x27;</span>,<span class="string">&#x27;pointer&#x27;</span>]);</span><br><span class="line"><span class="keyword">var</span> env = <span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">getEnv</span>();</span><br><span class="line"><span class="keyword">var</span> canshu1 = env.<span class="title function_">newStringUtf</span>(<span class="string">&quot;test&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> canshu2 = env.<span class="title function_">newStringUtf</span>(<span class="string">&quot;nihao&quot;</span>);</span><br><span class="line">canshu1 = env.<span class="title function_">getStringUtfChars</span>(canshu1,<span class="literal">false</span>);</span><br><span class="line">canshu2 = env.<span class="title function_">getStringUtfChars</span>(canshu2,<span class="literal">false</span>);</span><br><span class="line"><span class="keyword">var</span> ret = <span class="title function_">newaddString_func</span>(canshu1,canshu2);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(ret.<span class="title function_">readCString</span>());</span><br><span class="line"><span class="keyword">if</span>(hookdemo_add)&#123;</span><br><span class="line">    <span class="keyword">var</span> add_0D64 = hookdemo_add.<span class="title function_">add</span>(<span class="number">0x667A0</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;add_0D64 =&gt;&quot;</span>,add_0D64);</span><br><span class="line">    <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(add_0D64,&#123;</span><br><span class="line">        <span class="attr">onEnter</span>:<span class="keyword">function</span>(<span class="params">args</span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;args[0] =&gt;&quot;</span>,args[<span class="number">0</span>].<span class="title function_">readCString</span>());</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;args[1] =&gt;&quot;</span>,args[<span class="number">1</span>].<span class="title function_">readCString</span>());</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onLeave</span>:<span class="keyword">function</span>(<span class="params">retval</span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">hexdump</span>(retval))</span><br><span class="line">            <span class="comment">// console.log(&quot;retval&quot;,retval.readCString());</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">找到某方法的执行首地址</span><br><span class="line"><span class="number">1</span>、直接在<span class="variable constant_">IDA</span>里的导出方法搜索，双击进入到具体的处理逻辑，在开头按<span class="title class_">Tab</span>跳转汇编查看地址</span><br><span class="line"><span class="number">2</span>、找到某个已注册方法，并调用了目标方法，后续操作如上</span><br><span class="line"><span class="number">3</span>、<span class="variable constant_">IDA</span>的导出函数可以（静态so方法，及非动态的方法实现）</span><br></pre></td></tr></table></figure>

<p>1、根据内存中的地址 hook 函数<br>2、不确定 so 名，hook 其中的导出函数<br>3、hook 自实现的静态 so 函数<br>4、根据内存地址去主动调用函数</p>
<h2 id="Hook-动态注册SO函数："><a href="#Hook-动态注册SO函数：" class="headerlink" title="Hook 动态注册SO函数："></a>Hook 动态注册SO函数：</h2><p><a target="_blank" rel="noopener" href="https://github.com/lasting-yang/frida_hook_libart">https://github.com/lasting-yang/frida_hook_libart</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">原生打印出来的 symbols 需要转换</span><br><span class="line">https://demangler.com/</span><br><span class="line"></span><br><span class="line">hook sayhello，不知道包名求出这个注册函数的地址</span><br><span class="line">RegisterNatives 函数专门用于动态注册，hook这个就行</span><br><span class="line">动态注册在启动时就注入，用 attach 模式</span><br><span class="line">Process.findModuleByName(&quot;libhookdemo.so&quot;) // 得到当前进程内so的地址 </span><br><span class="line"></span><br><span class="line">1、hook所有的so函数</span><br><span class="line">2、hook动态注册函数</span><br></pre></td></tr></table></figure>



<h2 id="RPC-开放调用Java层和SO层函数"><a href="#RPC-开放调用Java层和SO层函数" class="headerlink" title="RPC 开放调用Java层和SO层函数"></a>RPC 开放调用Java层和SO层函数</h2><p>应用场景：<a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-259862.htm">https://bbs.kanxue.com/thread-259862.htm</a></p>
<p>修改默认端口(27042)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./frida-server -l 0.0.0.0:port</span><br><span class="line">frida -H ip:port -F</span><br></pre></td></tr></table></figure>

<p>用 web 服务(flask)映射手机内的接口</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">javafunc</span>(<span class="params">name</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> perins = <span class="literal">null</span>;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> perclass =  <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.example.hookdemo.Person&quot;</span>);</span><br><span class="line">        perins = perclass.$new(name,<span class="number">20</span>,<span class="string">&quot;zhongguo&quot;</span>);</span><br><span class="line">       </span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="title function_">send</span>(perins.<span class="title function_">getName</span>())</span><br><span class="line">    <span class="keyword">var</span> recy = <span class="title function_">recv</span>(<span class="string">&#x27;poke&#x27;</span>,<span class="keyword">function</span>(<span class="params">value</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(value.<span class="property">payload</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    recy.<span class="title function_">wait</span>()</span><br><span class="line">    <span class="keyword">return</span> perins.<span class="title function_">getName</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sofunc</span>(<span class="params">a1,a2</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> hookdemo_add = <span class="title class_">Module</span>.<span class="title function_">findBaseAddress</span>(<span class="string">&quot;libhookdemo.so&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> add_0D64 = hookdemo_add.<span class="title function_">add</span>(<span class="number">0x60D54</span>);</span><br><span class="line">    <span class="keyword">var</span> newaddString_func  = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(add_0D64,<span class="string">&quot;pointer&quot;</span>,[<span class="string">&#x27;pointer&#x27;</span>,<span class="string">&#x27;pointer&#x27;</span>])</span><br><span class="line">    <span class="keyword">var</span> env = <span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">getEnv</span>();</span><br><span class="line">    <span class="keyword">var</span> canshu1 = env.<span class="title function_">newStringUtf</span>(a1);</span><br><span class="line">    <span class="keyword">var</span> canshu2 = env.<span class="title function_">newStringUtf</span>(a2);</span><br><span class="line">    canshu1 = env.<span class="title function_">getStringUtfChars</span>(canshu1,<span class="literal">false</span>);</span><br><span class="line">    canshu2 = env.<span class="title function_">getStringUtfChars</span>(canshu2,<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">var</span> ret = <span class="title function_">newaddString_func</span>(canshu1,canshu2);</span><br><span class="line">    <span class="keyword">return</span> ret.<span class="title function_">readCString</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rpc.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">javafun</span>:javafunc,</span><br><span class="line">    <span class="attr">sofunc</span>:sofunc,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> frida</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> flask,requests</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">on_message</span>(<span class="params">message, data</span>):</span><br><span class="line">    <span class="comment"># print(message)</span></span><br><span class="line">    <span class="keyword">if</span> message[<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;send&#x27;</span>:</span><br><span class="line">        <span class="built_in">print</span>(message[<span class="string">&#x27;payload&#x27;</span>])</span><br><span class="line">        script.post(&#123;<span class="string">&quot;type&quot;</span>:<span class="string">&quot;poke&quot;</span>,<span class="string">&quot;payload&quot;</span>:<span class="string">&quot;woshipython&quot;</span>&#125;)</span><br><span class="line">    <span class="keyword">elif</span> message[<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;error&#x27;</span>:</span><br><span class="line">        <span class="built_in">print</span>(message[<span class="string">&#x27;stack&#x27;</span>])</span><br><span class="line"><span class="comment">#直接运行python脚本即可，注入程序在Python指定</span></span><br><span class="line"><span class="comment">#进程名称附加</span></span><br><span class="line">session = frida.get_usb_device(<span class="number">5000</span>).attach(<span class="string">&#x27;com.example.hookdemo&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#spwan 模式</span></span><br><span class="line"><span class="comment"># devices = frida.get_usb_device(5000)</span></span><br><span class="line"><span class="comment"># pid = devices.spawn([&#x27;com.example.hookdemo&#x27;])</span></span><br><span class="line"><span class="comment"># session = devices.attach(pid)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#连接非标准端口</span></span><br><span class="line"><span class="comment"># session = frida.get_device_manager().add_remote_device(&quot;192.168.10.5:1234&quot;).attach(&#x27;com.example.hookdemo&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># source = &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># &quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># 获取js脚本的功能代码</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;./function.js&quot;</span>)<span class="keyword">as</span> f:</span><br><span class="line">    source = f.read()</span><br><span class="line"><span class="comment"># print(source)</span></span><br><span class="line"></span><br><span class="line">script = session.create_script(source)</span><br><span class="line">script.on(<span class="string">&#x27;message&#x27;</span>, on_message)</span><br><span class="line">script.load()</span><br><span class="line"></span><br><span class="line"><span class="comment">#spwan模式多出来的</span></span><br><span class="line"><span class="comment"># devices.resume(pid)</span></span><br><span class="line"><span class="comment"># time.sleep(1)</span></span><br><span class="line"><span class="comment"># print(script.exports.javafun(&quot;nihao&quot;))</span></span><br><span class="line"><span class="comment"># print(script.exports.sofunc(&quot;nihao&quot;,&quot;muyang&quot;))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#注册路由，并写响应函数index</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    s1 = request.args.get(<span class="string">&#x27;a1&#x27;</span>)</span><br><span class="line">    s2 = request.args.get(<span class="string">&#x27;a2&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> script.exports.sofunc(s1,s2)</span><br><span class="line">     </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">     app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8888</span>, debug=<span class="literal">True</span>)  <span class="comment"># 运行程序  # app.run(host, port, debug, options)</span></span><br></pre></td></tr></table></figure>

<p>1、js 编写 frida 脚本，把函数导出<br>2、python 脚本调用 js 导出函数，开启 flask 服务供第三方调用<br>3、frida Python与js脚本交互</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Qwertyuiop2016/article/details/114286877">https://blog.csdn.net/Qwertyuiop2016/article/details/114286877</a></p>
<h2 id="Hook-interface接口"><a href="#Hook-interface接口" class="headerlink" title="Hook interface接口"></a>Hook interface接口</h2><p>搜 implement 关键词</p>
<h1 id="加密算法"><a href="#加密算法" class="headerlink" title="加密算法"></a>加密算法</h1><h2 id="URLTOHEX"><a href="#URLTOHEX" class="headerlink" title="URLTOHEX"></a>URLTOHEX</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// unsigned char 数组来存储字符串时，内部的字符会以其对应的 ASCII 值进行存储</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">encodeToHex</span><span class="params">(<span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>* data,<span class="type">int</span> dataSize,<span class="type">char</span>* encodeData)</span>&#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* hexChars = <span class="string">&quot;0123456789ABCDEF&quot;</span>;</span><br><span class="line">    <span class="type">int</span> i,j;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>,j=<span class="number">0</span>; i&lt;dataSize; ++i)&#123;</span><br><span class="line">        <span class="comment">// 此处data[i]已经转换</span></span><br><span class="line">        <span class="comment">// data[i] = 109(m) &gt;&gt; 4 = 01101101 &gt;&gt; 4 = 0110 &amp; 0x0f </span></span><br><span class="line">        <span class="comment">// 高四位 &amp; 0x0f</span></span><br><span class="line">        encodeData[j++] = hexChars[(data[i] &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0x0f</span>]; </span><br><span class="line">        <span class="comment">// 低四位 &amp; 0x0f</span></span><br><span class="line">        encodeData[j++] = hexChars[data[i] &amp; <span class="number">0x0f</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    encodeData[j]=<span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">// 一个字符一个字节</span></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* inputData = <span class="string">&quot;muxss&quot;</span>;</span><br><span class="line">    <span class="type">int</span> inputSize = <span class="built_in">strlen</span>(inputData);</span><br><span class="line">    <span class="type">char</span> encodeOutPut[<span class="built_in">strlen</span>(inputData)];</span><br><span class="line">    encodeToHex(inputData,inputSize,encodeOutPut);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Encode data: %s\n&quot;</span>,encodeOutPut); </span><br><span class="line">    <span class="comment">// 6D75787373</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>字符串转换为十六进制的原理是逐个字符读取字符串中的每个字符，获取其对应的 ASCII 值，然后将该整数值转换为十六进制表示。</p>
<p>每个字符占一个字节，两个十六进制</p>
<h2 id="Base64"><a href="#Base64" class="headerlink" title="Base64"></a>Base64</h2><p>ASCII 编码用 256(2的8次方)个字符对二进制数据进行编码</p>
<p>Base64 用 64(2的6次方)个字符对二进制数据进行编码，二进制数据到字符的过程</p>
<p>原理：</p>
<ul>
<li>用 64（2的6次方）个特定的 ASCII 字符来表示 256（2的8次方）个 ASCII 字符，也就是说三个 ASCII 字符经过 Base64 编码后变为四个 ASCII 字符显示（公约数为24），编码后数据长度比原来增加 1&#x2F;3，不足 3n用”&#x3D;”补齐。</li>
<li>小写字母a-z、大写字母A-Z、数字0-9、符号”+”、”&#x2F;“（再加上作为垫字的”&#x3D;”，实际上是65个字符）有时候+&#x2F;会变成 - , _</li>
<li>第一步：将每三个字节作为一组，一个是24个二进制位</li>
<li>第二步，将这24个二进制位分为四组，每个组有6个二进制位</li>
<li>第三步，在每组前面加两个00，扩展成32个二进制位，即四个字节</li>
<li>第四步，根据下表，得到扩展后的每个字节的对应符号，就是Base64的编码值</li>
<li>Base64编码表自查</li>
</ul>
<p>111 &#x3D;&gt; MTEx，每个字符占一个字节，每个字节有8位，总共有24位，而base64编码每个字符用6位表示，所以3个字节需要用4个可打印字符来表示。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">F T D</span><br><span class="line">70 84 68</span><br><span class="line">01000110   01010100   01000100</span><br><span class="line">(00)010001  (00)100101  (00)010001  (00)000100</span><br><span class="line">17  37  17  4</span><br><span class="line">R I R E</span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Base64字符表</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> base64_table[] = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Base64编码函数</span></span><br><span class="line"><span class="type">char</span>* <span class="title function_">base64_encode</span><span class="params">(<span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>* input, <span class="type">int</span> length)</span> &#123;</span><br><span class="line">    <span class="type">int</span> output_length = <span class="number">4</span> * ((length + <span class="number">2</span>) / <span class="number">3</span>);  <span class="comment">// 计算编码后字符串的长度</span></span><br><span class="line">    <span class="type">char</span>* encoded_data = (<span class="type">char</span>*)<span class="built_in">malloc</span>(output_length + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (encoded_data == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> i, j;</span><br><span class="line">    <span class="comment">//这一段是编码函数中的循环部分，用于对输入数据进行编码。</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>, j = <span class="number">0</span>; i &lt; length; i += <span class="number">3</span>, j += <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="comment">//每次处理3个字节的数据。首先，从输入数据中取出3个字节，分别赋值给byte1、byte2和byte3变量。如果输入数据长度不足3字节，则使用0填充。</span></span><br><span class="line">        <span class="type">unsigned</span> <span class="type">char</span> byte1 = input[i];</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">char</span> byte2 = (i + <span class="number">1</span> &lt; length) ? input[i + <span class="number">1</span>] : <span class="number">0</span>;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">char</span> byte3 = (i + <span class="number">2</span> &lt; length) ? input[i + <span class="number">2</span>] : <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        encoded_data[j] = base64_table[byte1 &gt;&gt; <span class="number">2</span>];  <span class="comment">//将byte1右移2位得到高6位的值，作为base64_table的索引，获得对应的Base64字符。</span></span><br><span class="line">        encoded_data[j + <span class="number">1</span>] = base64_table[((byte1 &amp; <span class="number">0x03</span>) &lt;&lt; <span class="number">4</span>) | (byte2 &gt;&gt; <span class="number">4</span>)];<span class="comment">//将byte1的低2位与byte2的高4位进行组合，得到一个8位的值，再将该值左移4位，得到base64_table的索引，获得对应的Base64字符。</span></span><br><span class="line">        encoded_data[j + <span class="number">2</span>] = base64_table[((byte2 &amp; <span class="number">0x0F</span>) &lt;&lt; <span class="number">2</span>) | (byte3 &gt;&gt; <span class="number">6</span>)];<span class="comment">//将byte2的低4位与byte3的高2位进行组合，得到一个8位的值，再将该值左移2位，得到base64_table的索引，获得对应的Base64字符。</span></span><br><span class="line">        encoded_data[j + <span class="number">3</span>] = base64_table[byte3 &amp; <span class="number">0x3F</span>];<span class="comment">//将byte3的低6位作为base64_table的索引，获得对应的Base64字符。</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加填充字符</span></span><br><span class="line">    <span class="type">int</span> padding = length % <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">if</span> (padding == <span class="number">1</span>) &#123;</span><br><span class="line">        encoded_data[j - <span class="number">2</span>] = <span class="string">&#x27;=&#x27;</span>;</span><br><span class="line">        encoded_data[j - <span class="number">1</span>] = <span class="string">&#x27;=&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (padding == <span class="number">2</span>) &#123;</span><br><span class="line">        encoded_data[j - <span class="number">1</span>] = <span class="string">&#x27;=&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    encoded_data[output_length] = <span class="string">&#x27;\0&#x27;</span>;  <span class="comment">// 添加字符串结束符</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> encoded_data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Base64解码函数</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span>* <span class="title function_">base64_decode</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* input, <span class="type">int</span>* length)</span> &#123;</span><br><span class="line">    <span class="type">int</span> input_length = <span class="built_in">strlen</span>(input);</span><br><span class="line">    <span class="keyword">if</span> (input_length % <span class="number">4</span> != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> output_length = input_length / <span class="number">4</span> * <span class="number">3</span>;  <span class="comment">// 计算解码后数据长度</span></span><br><span class="line">    <span class="keyword">if</span> (input[input_length - <span class="number">1</span>] == <span class="string">&#x27;=&#x27;</span>) &#123;</span><br><span class="line">        output_length--;</span><br><span class="line">        <span class="keyword">if</span> (input[input_length - <span class="number">2</span>] == <span class="string">&#x27;=&#x27;</span>) &#123;</span><br><span class="line">            output_length--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span>* decoded_data = (<span class="type">unsigned</span> <span class="type">char</span>*)<span class="built_in">malloc</span>(output_length);</span><br><span class="line">    <span class="keyword">if</span> (decoded_data == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> i, j;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>, j = <span class="number">0</span>; i &lt; input_length; i += <span class="number">4</span>, j += <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">char</span> ch1 = <span class="built_in">strchr</span>(base64_table, input[i]) - base64_table;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">char</span> ch2 = <span class="built_in">strchr</span>(base64_table, input[i + <span class="number">1</span>]) - base64_table;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">char</span> ch3 = <span class="built_in">strchr</span>(base64_table, input[i + <span class="number">2</span>]) - base64_table;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">char</span> ch4 = <span class="built_in">strchr</span>(base64_table, input[i + <span class="number">3</span>]) - base64_table;</span><br><span class="line"></span><br><span class="line">        decoded_data[j] = (ch1 &lt;&lt; <span class="number">2</span>) | (ch2 &gt;&gt; <span class="number">4</span>);</span><br><span class="line">        <span class="keyword">if</span> (j + <span class="number">1</span> &lt; output_length) &#123;</span><br><span class="line">            decoded_data[j + <span class="number">1</span>] = (ch2 &lt;&lt; <span class="number">4</span>) | (ch3 &gt;&gt; <span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (j + <span class="number">2</span> &lt; output_length) &#123;</span><br><span class="line">            decoded_data[j + <span class="number">2</span>] = (ch3 &lt;&lt; <span class="number">6</span>) | ch4;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    *length = output_length;</span><br><span class="line">    <span class="keyword">return</span> decoded_data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>* original_data = <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">    <span class="type">int</span> original_length = <span class="built_in">strlen</span>(original_data);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Base64编码</span></span><br><span class="line">    <span class="type">char</span>* encoded_data = base64_encode(original_data, original_length);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Base64 encoded data: %s\n&quot;</span>, encoded_data);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Base64解码</span></span><br><span class="line">    <span class="type">int</span> decoded_length;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span>* decoded_data = base64_decode(encoded_data, &amp;decoded_length);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Base64 decoded data: &quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; decoded_length; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, decoded_data[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>(encoded_data);</span><br><span class="line">    <span class="built_in">free</span>(decoded_data);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="消息摘要算法"><a href="#消息摘要算法" class="headerlink" title="消息摘要算法"></a>消息摘要算法</h2><p>消息摘要算法？</p>
<p>算法助手同理</p>
<p>md5 </p>
<p>WT-JS </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">    <span class="attr">showStacks</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">showDivider</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// console.log(&#x27;frida 已启动&#x27;);</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">showStacks</span>(<span class="params">name = <span class="string">&#x27;&#x27;</span></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (config.<span class="property">showStacks</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;android.util.Log&#x27;</span>).<span class="title function_">getStackTraceString</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;java.lang.Throwable&#x27;</span>).$new(name)))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">showDivider</span>(<span class="params">name = <span class="string">&#x27;&#x27;</span></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (config.<span class="property">showDivider</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`==============================<span class="subst">$&#123;name&#125;</span>==============================`</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">showArguments</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;arguments: &#x27;</span>, ...<span class="variable language_">arguments</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">ByteString</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;com.android.okhttp.okio.ByteString&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">Encode</span> = &#123;</span><br><span class="line">      <span class="title function_">toBase64</span>(<span class="params">tag, data</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(tag + <span class="string">&#x27; Base64: &#x27;</span>, <span class="title class_">ByteString</span>.<span class="title function_">of</span>(data).<span class="title function_">base64</span>())</span><br><span class="line">        <span class="comment">// console.log(tag + &#x27; Base64: &#x27;, bytesToBase64(data));</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">toHex</span>(<span class="params">tag, data</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(tag + <span class="string">&#x27; Hex: &#x27;</span>, <span class="title class_">ByteString</span>.<span class="title function_">of</span>(data).<span class="title function_">hex</span>())</span><br><span class="line">        <span class="comment">// console.log(tag + &#x27; Hex: &#x27;, bytesToHex(data));</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">toUtf8</span>(<span class="params">tag, data</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(tag + <span class="string">&#x27; Utf8: &#x27;</span>, <span class="title class_">ByteString</span>.<span class="title function_">of</span>(data).<span class="title function_">utf8</span>())</span><br><span class="line">        <span class="comment">// console.log(tag + &#x27; Utf8: &#x27;, bytesToString(data));</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">toAll</span>(<span class="params">tag, data</span>) &#123;</span><br><span class="line">        <span class="title class_">Encode</span>.<span class="title function_">toUtf8</span>(tag, data)</span><br><span class="line">        <span class="title class_">Encode</span>.<span class="title function_">toHex</span>(tag, data)</span><br><span class="line">        <span class="title class_">Encode</span>.<span class="title function_">toBase64</span>(tag, data)</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">toResult</span>(<span class="params">tag, data</span>) &#123;</span><br><span class="line">        <span class="title class_">Encode</span>.<span class="title function_">toHex</span>(tag, data)</span><br><span class="line">        <span class="title class_">Encode</span>.<span class="title function_">toBase64</span>(tag, data)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">MessageDigest</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="params"><span class="string">&#x27;java.security.MessageDigest&#x27;</span></span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">let</span> overloads_update = <span class="title class_">MessageDigest</span>.<span class="property">update</span>.<span class="property">overloads</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_update) &#123;</span><br><span class="line">        overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">          <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">          <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">          <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">          <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">          <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">update</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">let</span> overloads_digest = <span class="title class_">MessageDigest</span>.<span class="property">digest</span>.<span class="property">overloads</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_digest) &#123;</span><br><span class="line">        overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">          <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">          <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">          <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">          <span class="keyword">const</span> result = <span class="variable language_">this</span>.<span class="title function_">digest</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">          &#125;</span><br><span class="line">  </span><br><span class="line">          <span class="title class_">Encode</span>.<span class="title function_">toResult</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> digest result`</span>, result)</span><br><span class="line">          <span class="keyword">return</span> result</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">Mac</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="params"><span class="string">&#x27;javax.crypto.Mac&#x27;</span></span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="title class_">Mac</span>.<span class="property">init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.security.Key&#x27;</span>, <span class="string">&#x27;java.security.spec.AlgorithmParameterSpec&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">key, AlgorithmParameterSpec</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">init</span>(key, <span class="title class_">AlgorithmParameterSpec</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title class_">Mac</span>.<span class="property">init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.security.Key&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">key</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">        <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">        <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">        <span class="keyword">const</span> keyBytes = key.<span class="title function_">getEncoded</span>()</span><br><span class="line">        <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> init Key`</span>, keyBytes)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">init</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">      <span class="keyword">let</span> overloads_doFinal = <span class="title class_">Mac</span>.<span class="property">doFinal</span>.<span class="property">overloads</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_doFinal) &#123;</span><br><span class="line">        overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">          <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">          <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">          <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">          <span class="keyword">const</span> result = <span class="variable language_">this</span>.<span class="title function_">doFinal</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">          &#125;</span><br><span class="line">  </span><br><span class="line">          <span class="title class_">Encode</span>.<span class="title function_">toResult</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> doFinal result`</span>, result)</span><br><span class="line">          <span class="keyword">return</span> result</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">Cipher</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="params"><span class="string">&#x27;javax.crypto.Cipher&#x27;</span></span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">let</span> overloads_init = <span class="title class_">Cipher</span>.<span class="property">init</span>.<span class="property">overloads</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_init) &#123;</span><br><span class="line">        overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">          <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">          <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">          <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">  </span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">arguments</span>[<span class="number">0</span>]) &#123;</span><br><span class="line">            <span class="keyword">const</span> mode = <span class="variable language_">arguments</span>[<span class="number">0</span>]</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> init mode`</span>, mode)</span><br><span class="line">          &#125;</span><br><span class="line">  </span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">arguments</span>[<span class="number">1</span>]) &#123;</span><br><span class="line">            <span class="keyword">const</span> className = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">arguments</span>[<span class="number">1</span>])</span><br><span class="line">            <span class="comment">// 安卓10以上私钥是有可能输出不了的</span></span><br><span class="line">            <span class="keyword">if</span> (className.<span class="title function_">includes</span>(<span class="string">&#x27;OpenSSLRSAPrivateKey&#x27;</span>)) &#123;</span><br><span class="line">              <span class="comment">// const keyBytes = arguments[1];</span></span><br><span class="line">              <span class="comment">// console.log(`$&#123;algorithm&#125; init key`, keyBytes);</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="keyword">const</span> keyBytes = <span class="variable language_">arguments</span>[<span class="number">1</span>].<span class="title function_">getEncoded</span>()</span><br><span class="line">              <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> init key`</span>, keyBytes)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">  </span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">arguments</span>[<span class="number">2</span>]) &#123;</span><br><span class="line">            <span class="keyword">const</span> className = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">arguments</span>[<span class="number">2</span>])</span><br><span class="line">            <span class="keyword">if</span> (className.<span class="title function_">includes</span>(<span class="string">&#x27;javax.crypto.spec.IvParameterSpec&#x27;</span>)) &#123;</span><br><span class="line">              <span class="keyword">const</span> iv = <span class="title class_">Java</span>.<span class="title function_">cast</span>(<span class="variable language_">arguments</span>[<span class="number">2</span>], <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;javax.crypto.spec.IvParameterSpec&#x27;</span>))</span><br><span class="line">              <span class="keyword">const</span> ivBytes = iv.<span class="title function_">getIV</span>()</span><br><span class="line">              <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> init iv`</span>, ivBytes)</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (className.<span class="title function_">includes</span>(<span class="string">&#x27;java.security.SecureRandom&#x27;</span>)) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">  </span><br><span class="line">          <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">init</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">let</span> overloads_doFinal = <span class="title class_">Cipher</span>.<span class="property">doFinal</span>.<span class="property">overloads</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_doFinal) &#123;</span><br><span class="line">        overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">          <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">          <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">          <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">          <span class="keyword">const</span> result = <span class="variable language_">this</span>.<span class="title function_">doFinal</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">          &#125;</span><br><span class="line">  </span><br><span class="line">          <span class="title class_">Encode</span>.<span class="title function_">toResult</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> doFinal result`</span>, result)</span><br><span class="line">          <span class="keyword">return</span> result</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">Signature</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="params"><span class="string">&#x27;java.security.Signature&#x27;</span></span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">let</span> overloads_update = <span class="title class_">Signature</span>.<span class="property">update</span>.<span class="property">overloads</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_update) &#123;</span><br><span class="line">        overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">          <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">          <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">          <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">          <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">          <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">update</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">let</span> overloads_sign = <span class="title class_">Signature</span>.<span class="property">sign</span>.<span class="property">overloads</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_sign) &#123;</span><br><span class="line">        overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123; </span><br><span class="line">          <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">          <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">          <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">          <span class="keyword">const</span> result = <span class="variable language_">this</span>.<span class="title function_">sign</span>()</span><br><span class="line">          <span class="title class_">Encode</span>.<span class="title function_">toResult</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> sign result`</span>, result)</span><br><span class="line">          <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">sign</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<h2 id="对称加密算法-amp-非对称加密算法"><a href="#对称加密算法-amp-非对称加密算法" class="headerlink" title="对称加密算法 &amp; 非对称加密算法"></a>对称加密算法 &amp; 非对称加密算法</h2><p>DES&#x2F;CBC&#x2F;PKCS5Padding  原理自查</p>
<p>代码如上</p>
<h2 id="其他乱七八糟的"><a href="#其他乱七八糟的" class="headerlink" title="其他乱七八糟的"></a>其他乱七八糟的</h2><p>图解 HTTP</p>
<p>okhttp框架（学习hook绕过证书单向校验、证书双向校验）</p>
<p><a target="_blank" rel="noopener" href="https://github.com/WooyunDota/DroidSSLUnpinning?tab=readme-ov-file">https://github.com/WooyunDota/DroidSSLUnpinning?tab=readme-ov-file</a></p>
<p><a target="_blank" rel="noopener" href="https://codeshare.frida.re/@akabe1/frida-multiple-unpinning/">https://codeshare.frida.re/@akabe1/frida-multiple-unpinning/</a></p>
<p><a target="_blank" rel="noopener" href="https://ch3nye.top/Android-HTTPS%E8%AE%A4%E8%AF%81%E7%9A%84N%E7%A7%8D%E6%96%B9%E5%BC%8F%E5%92%8C%E5%AF%B9%E6%8A%97%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93">https://ch3nye.top/Android-HTTPS认证的N种方式和对抗方法总结</a></p>
<p>下载导入 httpstest，apk源码</p>
<p>SSL PINNING 更新公钥和证书：</p>
<p>1、修改百度公钥，from hex，tobase64</p>
<p>2、修改bing.com的证书校验，导出baidu的证书，校验的网站也改成百度</p>
<p>对抗VPN和代理</p>
<p>ProxyDroid</p>
<p>iptables——在app限制代理和vpn抓包下的另类 解决办法</p>
<p>r0capture</p>
<p>flutter (app开发框架) 抓包</p>
<p>IDA 搜索 ssl_client，选择所在函数头的特征码，operation-General-Number of opcode bytes (4)</p>
<p>用 frida hook app 内部 SSL 验证，把校验关了就能抓到包了。用在挂了代理&#x2F;VPN抓不到包的场景</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_ssl_verify_result</span>(<span class="params">address</span>) &#123;</span><br><span class="line">    <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(address, &#123;</span><br><span class="line">            <span class="attr">onEnter</span>: <span class="keyword">function</span>(<span class="params">args</span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Disabling SSL validation&quot;</span>)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">onLeave</span>: <span class="keyword">function</span>(<span class="params">retval</span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Retval: &quot;</span> + retval);</span><br><span class="line">                retval.<span class="title function_">replace</span>(<span class="number">0x1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// lib目录下</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hookFlutter</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> m = <span class="title class_">Process</span>.<span class="title function_">findModuleByName</span>(<span class="string">&quot;libflutter.so&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> pattern = <span class="string">&quot;FF 03 05 D1 FD 7B 0F A9 9A E3 05 94 08 0A 80 52 48 00 00 39 16 54 40 F9 56 07 00 B4 C8 02 40 F9 08 07 00 B4&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> res = <span class="title class_">Memory</span>.<span class="title function_">scan</span>(m.<span class="property">base</span>, m.<span class="property">size</span>, pattern, &#123;</span><br><span class="line">            <span class="attr">onMatch</span>: <span class="keyword">function</span>(<span class="params">address, size</span>)&#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[+] ssl_verify_result found at: &#x27;</span> + address.<span class="title function_">toString</span>());</span><br><span class="line">                <span class="title function_">hook_ssl_verify_result</span>(address); </span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">onError</span>: <span class="keyword">function</span>(<span class="params">reason</span>)&#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[!] There was an error scanning memory&#x27;</span>);</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">onComplete</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;All done&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>动态加载 dex，dex文件是apk的二进制包？</p>
<p>三代加壳技术</p>
<p>frida_dexdump，用objection加载插件，python启动 </p>
<p>grep -ril “xxx” * &#x2F;&#x2F;在dex目录搜关键词</p>
<p>一代壳直接dump，内存即完整</p>
<p>二代壳动态加载，youpk</p>
<p>第一次启动 frida 时的 venv 环境切换</p>
<h1 id="抓取海外app的包"><a href="#抓取海外app的包" class="headerlink" title="抓取海外app的包"></a>抓取海外app的包</h1><p>Charles_Proxy_External Proxy Settings_打勾前两个，用于设置 charles 的上游出口</p>
<p>app -&gt;VPN -&gt; Charles -&gt; 本地proxy -&gt;服务器</p>
<p>用在线工具把请求头直接转换成py代码、右键copy cURL Request</p>
<p><a target="_blank" rel="noopener" href="https://curlconverter.com/">https://curlconverter.com</a></p>
<p>分析 x-xxx-devices</p>
<p>1、apk直接拖进 jadx</p>
<p>2、搜索 &#x2F; 自吐脚本或者算法助手 &#x2F; 手动定位</p>
<p>3、jadx 选中字段按 x，查找调用</p>
<p>4、默认手机里安装的apk在，&#x2F;data&#x2F;data&#x2F;包名&#x2F;shared_prefs</p>
<p>5、清除应用信息，缓存的文件就没了</p>
<p>6、有个a方法</p>
<p><a target="_blank" rel="noopener" href="https://boyyongxin.github.io/2021/06/10/%E5%A6%82%E4%BD%95%E6%8A%93%E5%8F%96%E5%9B%BD%E5%A4%96%E7%BD%91%E7%AB%99%E3%80%81app%E7%9A%84%E5%8C%85">https://boyyongxin.github.io/2021/06/10/%E5%A6%82%E4%BD%95%E6%8A%93%E5%8F%96%E5%9B%BD%E5%A4%96%E7%BD%91%E7%AB%99%E3%80%81app%E7%9A%84%E5%8C%85</a></p>
<p>1、搜索字段 x-xxx-signature<br>2、密码学基础：(这个key就是加密值)<br>        2.1、mac.update(key)<br>        2.2、doFinal(key)</p>
<pre><code>(根据digest往上找，根据空字符串去做SHA256加密-&gt;FROM HEX-&gt;to base64)

HmacSHA256 update data Utf8:  digest:47DEQpj8HBSa+/TImW+5JCeuQeRkm5NMpJWZG3hSuFU=
host:openapi.xxx.com
key-id:gf665hj0kpsdkpllgek11zrz
target:get /xxxapps/v3/bespoke/member/search-with-ads/mmx?keywords=iphone case mockup&amp;currency=CNY&amp;buyer_features[app_foreground_time]=1730735563258&amp;buyer_features[app_initial_start_time]=1730304497092&amp;buyer_features[device_model]=OnePlus GM1910&amp;buyer_features[network_type]=WWAN&amp;with_static_filters=true&amp;include_additional_listing_images=true&amp;ship_to=CN&amp;instant_download=null&amp;category_prolist=1&amp;sort_on=score&amp;sort_order=down&amp;include_featured_categories=false&amp;with_deep_facets=1
timestamp:1730736403
version:1
x-xxx-device:1k5BCmYBShylRczcYkN5HQ
HmacSHA256 update data Hex:  6469676573743a3437444....
HmacSHA256 update data Base64:  ZGlnZXN0OjQ3REVRcGo4S....

HmacSHA256 doFinal result Hex:  a1dd6501b449be5b....
HmacSHA256 doFinal result Base64:  od1lAbRJvlvA794Un2/vXWnM6L0DWHriXmWEwENNiD4=
AES/CTR/NoPadding update data Utf8:  oauth2_access_token
AES/CTR/NoPadding update data Hex:  6f61757468325f6163636573735f746f6b656e
AES/CTR/NoPadding update data Base64:  b2F1dGgyX2FjY2Vzc190b2tlbg==
AES/CTR/NoPadding doFinal result Hex:  2def734bbf607b03703dbf58ca6ded8ebf578d
AES/CTR/NoPadding doFinal result Base64:  Le9zS79gewNwPb9Yym3tjr9XjQ==
</code></pre>
<p>3、算法还原（cyberchef &#x2F; java代码）<br>    hmac (key、SHA256)<br>    FROM HEX<br>    TO BASE64</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">device_id.py</span><br><span class="line"></span><br><span class="line">UUID randomUUID = UUID.randomUUID();</span><br><span class="line">ByteBuffer wrap = ByteBuffer.wrap(new byte[16]);</span><br><span class="line">wrap.putLong(randomUUID.getMostSignificantBits());</span><br><span class="line">wrap.putLong(randomUUID.getLeastSignificantBits());</span><br><span class="line">return Base64.encodeToString(wrap.array(), 11);</span><br></pre></td></tr></table></figure>





<h3 id="xBox-算法还原"><a href="#xBox-算法还原" class="headerlink" title="xBox  算法还原"></a>xBox  算法还原</h3><p>1、frida-dump 脱壳多个dex，利用其他 frida 脚本  youpk &#x2F; aprt &#x2F; FART脱壳</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">frida脚本脱壳</span><br><span class="line">1、dex写入目录需要权限</span><br><span class="line">2、mkdir box_fart / mv *.dex box_fart/</span><br><span class="line">3、adb pull xxx/box_fart</span><br><span class="line">grep -ril &quot;xxxMainActivity&quot; //当前目录的dex搜索</span><br><span class="line"></span><br><span class="line">frida-dump -&gt; FART -&gt; youpk</span><br><span class="line">logcat</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-259854.htm">https://bbs.kanxue.com/thread-259854.htm</a></p>
<p>脱下来也是多个dex</p>
<p>疑问：为什么这里要用Youpk脱壳呢，用frida-dump不行嘛</p>
<p>2、过 root 检测</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1、jadx会重命名，要hook原来的包名</span><br><span class="line">2、js脚本 </span><br><span class="line">function xxx()&#123;</span><br><span class="line">	Java.perform(function()&#123;</span><br><span class="line">		xxx</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line">function main() &#123;</span><br><span class="line">    xxx()</span><br><span class="line">&#125;    </span><br><span class="line">setInterval(main, 1000);</span><br><span class="line">// 有壳 frida 脚本要延迟加载</span><br></pre></td></tr></table></figure>

<p>绕过后没数据，有VPN检测</p>
<p>利用 AS 的 logcat 可以查看当前手机运行的 app 打印的日志</p>
<p>用 AS 查看方便点，直接 adb logcat 也行</p>
<p>3、flutter框架的抓包方式</p>
<p><a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-261941.htm">https://bbs.kanxue.com/thread-261941.htm</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7106300111927377956">https://juejin.cn/post/7106300111927377956</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">直接按压缩包方式解压找到 libflutter.so，分析 SSL 入口点</span><br><span class="line">1、IDA 打开 libflutter.so</span><br><span class="line">2、Shift+F12 搜索 ssl_client</span><br><span class="line">3、找引用</span><br><span class="line">4、反汇编</span><br><span class="line">5、找开头 sub_xxx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">shift+f12：可以打开string窗口，一键找出所有的字符串，右击setup，还能对窗口的属性进行设置</span><br><span class="line">x：对着某个函数、变量按该快捷键，可以查看它的交叉引用</span><br><span class="line">g：直接跳转到某个地址</span><br><span class="line">f5：一键反汇编</span><br></pre></td></tr></table></figure>

<p>HttpCanary</p>
<p>wToken</p>
<p>4、RPC远程调用</p>
<h3 id="PANDA-8-33-0-算法还原"><a href="#PANDA-8-33-0-算法还原" class="headerlink" title="PANDA(8.33.0) 算法还原"></a>PANDA(8.33.0) 算法还原</h3><p>md5可能是16位也可能是32位</p>
<p>1、算法助手和自吐脚本都是hook某个操作过程的算法操作，可用于分析加密</p>
<p>2、自吐脚本是通用的嘛</p>
<p><a target="_blank" rel="noopener" href="https://www.secpulse.com/archives/177572.html">https://www.secpulse.com/archives/177572.html</a></p>
<p>request_pkcs12</p>
<p>估计是证书没导入到抓包软件导致抓不到</p>
<h3 id="xliji-算法还原"><a href="#xliji-算法还原" class="headerlink" title="xliji  算法还原"></a>xliji  算法还原</h3><p>1、检测 root，最简单就直接 hook 返回 false（当前运行环境有风险）</p>
<p>2、DES只取8个字节</p>
<p>算法还原，请求里的每个加密字段 addHeader</p>
<p>base64 后要 to hex下</p>
<p>具体是在分析哪个字段</p>
<p>目标：</p>
<p>1、based 字段的生成，每次都是固定。自吐脚本跟踪堆栈，跟踪生成加密的具体方法，用java还原</p>
<p>2、phone字段的生成，<strong>不确定就 hook 某个函数的返回值</strong></p>
<p>3、简单还原函数调用直接就hook入参</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// zitu.js</span></span><br><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">    <span class="attr">showStacks</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">showDivider</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// console.log(&#x27;frida 已启动&#x27;);</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">showStacks</span>(<span class="params">name = <span class="string">&#x27;&#x27;</span></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (config.<span class="property">showStacks</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;android.util.Log&#x27;</span>).<span class="title function_">getStackTraceString</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;java.lang.Throwable&#x27;</span>).$new(name)))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">showDivider</span>(<span class="params">name = <span class="string">&#x27;&#x27;</span></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (config.<span class="property">showDivider</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`==============================<span class="subst">$&#123;name&#125;</span>==============================`</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">showArguments</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;arguments: &#x27;</span>, ...<span class="variable language_">arguments</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">ByteString</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;com.android.okhttp.okio.ByteString&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">Encode</span> = &#123;</span><br><span class="line">      <span class="title function_">toBase64</span>(<span class="params">tag, data</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(tag + <span class="string">&#x27; Base64: &#x27;</span>, <span class="title class_">ByteString</span>.<span class="title function_">of</span>(data).<span class="title function_">base64</span>())</span><br><span class="line">        <span class="comment">// console.log(tag + &#x27; Base64: &#x27;, bytesToBase64(data));</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">toHex</span>(<span class="params">tag, data</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(tag + <span class="string">&#x27; Hex: &#x27;</span>, <span class="title class_">ByteString</span>.<span class="title function_">of</span>(data).<span class="title function_">hex</span>())</span><br><span class="line">        <span class="comment">// console.log(tag + &#x27; Hex: &#x27;, bytesToHex(data));</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">toUtf8</span>(<span class="params">tag, data</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(tag + <span class="string">&#x27; Utf8: &#x27;</span>, <span class="title class_">ByteString</span>.<span class="title function_">of</span>(data).<span class="title function_">utf8</span>())</span><br><span class="line">        <span class="comment">// console.log(tag + &#x27; Utf8: &#x27;, bytesToString(data));</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">toAll</span>(<span class="params">tag, data</span>) &#123;</span><br><span class="line">        <span class="title class_">Encode</span>.<span class="title function_">toUtf8</span>(tag, data)</span><br><span class="line">        <span class="title class_">Encode</span>.<span class="title function_">toHex</span>(tag, data)</span><br><span class="line">        <span class="title class_">Encode</span>.<span class="title function_">toBase64</span>(tag, data)</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">toResult</span>(<span class="params">tag, data</span>) &#123;</span><br><span class="line">        <span class="title class_">Encode</span>.<span class="title function_">toHex</span>(tag, data)</span><br><span class="line">        <span class="title class_">Encode</span>.<span class="title function_">toBase64</span>(tag, data)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">MessageDigest</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="params"><span class="string">&#x27;java.security.MessageDigest&#x27;</span></span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">let</span> overloads_update = <span class="title class_">MessageDigest</span>.<span class="property">update</span>.<span class="property">overloads</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_update) &#123;</span><br><span class="line">        overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">          <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">          <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">          <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">          <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">          <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">update</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">let</span> overloads_digest = <span class="title class_">MessageDigest</span>.<span class="property">digest</span>.<span class="property">overloads</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_digest) &#123;</span><br><span class="line">        overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">          <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">          <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">          <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">          <span class="keyword">const</span> result = <span class="variable language_">this</span>.<span class="title function_">digest</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">          &#125;</span><br><span class="line">  </span><br><span class="line">          <span class="title class_">Encode</span>.<span class="title function_">toResult</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> digest result`</span>, result)</span><br><span class="line">          <span class="keyword">return</span> result</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">Mac</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="params"><span class="string">&#x27;javax.crypto.Mac&#x27;</span></span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="title class_">Mac</span>.<span class="property">init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.security.Key&#x27;</span>, <span class="string">&#x27;java.security.spec.AlgorithmParameterSpec&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">key, AlgorithmParameterSpec</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">init</span>(key, <span class="title class_">AlgorithmParameterSpec</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title class_">Mac</span>.<span class="property">init</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.security.Key&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">key</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">        <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">        <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">        <span class="keyword">const</span> keyBytes = key.<span class="title function_">getEncoded</span>()</span><br><span class="line">        <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> init Key`</span>, keyBytes)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">init</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">      <span class="keyword">let</span> overloads_update = <span class="title class_">Mac</span>.<span class="property">update</span>.<span class="property">overloads</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_update) &#123;</span><br><span class="line">        overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">          <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">          <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">          <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">          <span class="comment">// const result = this.update(...arguments)</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">update</span>(...<span class="variable language_">arguments</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> overloads_doFinal = <span class="title class_">Mac</span>.<span class="property">doFinal</span>.<span class="property">overloads</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_doFinal) &#123;</span><br><span class="line">        overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">          <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">          <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">          <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">          <span class="keyword">const</span> result = <span class="variable language_">this</span>.<span class="title function_">doFinal</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">          &#125;</span><br><span class="line">  </span><br><span class="line">          <span class="title class_">Encode</span>.<span class="title function_">toResult</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> doFinal result`</span>, result)</span><br><span class="line">          <span class="keyword">return</span> result</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">Cipher</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="params"><span class="string">&#x27;javax.crypto.Cipher&#x27;</span></span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">let</span> overloads_init = <span class="title class_">Cipher</span>.<span class="property">init</span>.<span class="property">overloads</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_init) &#123;</span><br><span class="line">        overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">          <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">          <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">          <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">  </span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">arguments</span>[<span class="number">0</span>]) &#123;</span><br><span class="line">            <span class="keyword">const</span> mode = <span class="variable language_">arguments</span>[<span class="number">0</span>]</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> init mode`</span>, mode)</span><br><span class="line">          &#125;</span><br><span class="line">  </span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">arguments</span>[<span class="number">1</span>]) &#123;</span><br><span class="line">            <span class="keyword">const</span> className = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">arguments</span>[<span class="number">1</span>])</span><br><span class="line">            <span class="comment">// 安卓10以上私钥是有可能输出不了的</span></span><br><span class="line">            <span class="keyword">if</span> (className.<span class="title function_">includes</span>(<span class="string">&#x27;OpenSSLRSAPrivateKey&#x27;</span>)) &#123;</span><br><span class="line">              <span class="comment">// const keyBytes = arguments[1];</span></span><br><span class="line">              <span class="comment">// console.log(`$&#123;algorithm&#125; init key`, keyBytes);</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="keyword">const</span> keyBytes = <span class="variable language_">arguments</span>[<span class="number">1</span>].<span class="title function_">getEncoded</span>()</span><br><span class="line">              <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> init key`</span>, keyBytes)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">  </span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">arguments</span>[<span class="number">2</span>]) &#123;</span><br><span class="line">            <span class="keyword">const</span> className = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">arguments</span>[<span class="number">2</span>])</span><br><span class="line">            <span class="keyword">if</span> (className.<span class="title function_">includes</span>(<span class="string">&#x27;javax.crypto.spec.IvParameterSpec&#x27;</span>)) &#123;</span><br><span class="line">              <span class="keyword">const</span> iv = <span class="title class_">Java</span>.<span class="title function_">cast</span>(<span class="variable language_">arguments</span>[<span class="number">2</span>], <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;javax.crypto.spec.IvParameterSpec&#x27;</span>))</span><br><span class="line">              <span class="keyword">const</span> ivBytes = iv.<span class="title function_">getIV</span>()</span><br><span class="line">              <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> init iv`</span>, ivBytes)</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (className.<span class="title function_">includes</span>(<span class="string">&#x27;java.security.SecureRandom&#x27;</span>)) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">  </span><br><span class="line">          <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">init</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">let</span> overloads_doFinal = <span class="title class_">Cipher</span>.<span class="property">doFinal</span>.<span class="property">overloads</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_doFinal) &#123;</span><br><span class="line">        overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">          <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">          <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">          <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">          <span class="keyword">const</span> result = <span class="variable language_">this</span>.<span class="title function_">doFinal</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> === <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">          &#125;</span><br><span class="line">  </span><br><span class="line">          <span class="title class_">Encode</span>.<span class="title function_">toResult</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> doFinal result`</span>, result)</span><br><span class="line">          <span class="keyword">return</span> result</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">Signature</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="params"><span class="string">&#x27;java.security.Signature&#x27;</span></span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">let</span> overloads_update = <span class="title class_">Signature</span>.<span class="property">update</span>.<span class="property">overloads</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_update) &#123;</span><br><span class="line">        overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">          <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">          <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">          <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">          <span class="title class_">Encode</span>.<span class="title function_">toAll</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> update data`</span>, <span class="variable language_">arguments</span>[<span class="number">0</span>])</span><br><span class="line">          <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">update</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">let</span> overloads_sign = <span class="title class_">Signature</span>.<span class="property">sign</span>.<span class="property">overloads</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> overload <span class="keyword">of</span> overloads_sign) &#123;</span><br><span class="line">        overload.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">          <span class="keyword">const</span> algorithm = <span class="variable language_">this</span>.<span class="title function_">getAlgorithm</span>()</span><br><span class="line">          <span class="title function_">showDivider</span>(algorithm)</span><br><span class="line">          <span class="title function_">showStacks</span>(algorithm)</span><br><span class="line">          <span class="keyword">const</span> result = <span class="variable language_">this</span>.<span class="title function_">sign</span>()</span><br><span class="line">          <span class="title class_">Encode</span>.<span class="title function_">toResult</span>(<span class="string">`<span class="subst">$&#123;algorithm&#125;</span> sign result`</span>, result)</span><br><span class="line">          <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">sign</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<p>&#x2F;data&#x2F;data 目录下就是解压的</p>
<p>package</p>
<h3 id="请求内容和响应内容加密"><a href="#请求内容和响应内容加密" class="headerlink" title="请求内容和响应内容加密"></a>请求内容和响应内容加密</h3><p>sign和返回值加密</p>
<p>cmm（4.2.0）</p>
<p>算法助手的使用（xposed选系统框架后要重启、夜神模拟器4.4)</p>
<p>Fundex脱壳，360加固就是脱不了</p>
<ul>
<li>找调用就一层一层往上找</li>
<li>分析参数加密算法</li>
<li>分析返回的加密数据，还原即可</li>
<li>到现在Fundex就没脱壳成功过，安卓4不是还没支持xposed吗</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;data&quot;: &#123;</span><br><span class="line">		&quot;is_encrypt&quot;: true,</span><br><span class="line">		&quot;data&quot;: &quot;Cn/r/UgLbh6mpdV0wz1v7XaIrNBr3MI6+kY6+8QoYhd2HFA==&quot;</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;errCode&quot;: 0,</span><br><span class="line">	&quot;rid&quot;: &quot;f0d9d0e7efae4af6e03343fab383d7d5&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h3 id="请求内容和返回值乱码"><a href="#请求内容和返回值乱码" class="headerlink" title="请求内容和返回值乱码"></a>请求内容和返回值乱码</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zbw（3.1.5）</span><br><span class="line">aHR0cHM6Ly9tLmp5c2VkdS5jb20vYXBwLzkyNzMuaHRtbA==</span><br></pre></td></tr></table></figure>

<h4 id="加密"><a href="#加密" class="headerlink" title="加密"></a>加密</h4><p>1f8b gunzip</p>
<p>定义加密和解密脚本（base64加密-&gt;gunzip加密）</p>
<img src="/2024/07/31/Notes-Android/03.png" class title="This is an example image">

<img src="/2024/07/31/Notes-Android/05.png" class title="This is an example image">

<p>这里只解了gunzip的加密</p>
<img src="/2024/07/31/Notes-Android/04.png" class title="This is an example image">

<p>加密是自上而下的</p>
<img src="/2024/07/31/Notes-Android/06.png" class title="This is an example image">

<p>不确定哪个重载就往上翻</p>
<img src="/2024/07/31/Notes-Android/07.png" class title="This is an example image">

<p>遇事不决 ChatGPT</p>
<p>1、自吐脚本hook</p>
<p>2、特殊的encodeBase64Chunked 会以每行76个字符分块 \r\n</p>
<p>3、hook base64加密后的，打印发现也是每76个字符换行</p>
<p>4、hook用户名不存在</p>
<h4 id="解密"><a href="#解密" class="headerlink" title="解密"></a>解密</h4><p>服务器返回信息提示用户，必须解密，分析此解密过程（”用户名不存在”）</p>
<img src="/2024/07/31/Notes-Android/08.png" class title="This is an example image">

<h3 id="Charles-抓包问题汇总"><a href="#Charles-抓包问题汇总" class="headerlink" title="Charles 抓包问题汇总"></a>Charles 抓包问题汇总</h3><p>1、开启 Enabke SSL Proxy就是为了抓https的包，证书有问题的情况下，开启后无法访问</p>
<p>2、模拟器放到 &#x2F;storage&#x2F;emulated&#x2F;0&#x2F;Pictures&#x2F; 目录下</p>
<p>3、模拟器和主机重启，不行就再重启（postren走的是socket5）</p>
<p>4、真机每次切换证书可以试试重启，抓不到包换个浏览器，真机有时候只能用默认浏览器抓包，可能是证书安装有问题，其他浏览器不信任系统证书。但APP是可以抓包的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">https://www.jianshu.com/p/c546783ad284</span><br><span class="line">https://developer.android.com/ndk/guides/other_build_systems?hl=zh-cn</span><br><span class="line">https://www.cnblogs.com/burner/p/clang-fen-si-bu-bian-yimainc.html   编译博客也不错</span><br><span class="line">https://blog.csdn.net/qq_31865983/article/details/89402100    这个更加完整一点</span><br><span class="line">https://github.com/hugsy/gef</span><br><span class="line">https://www.likecs.com/show-204245381.html#sc=400</span><br><span class="line">Cortex-A7 常用汇编指令资料:</span><br><span class="line">https://www.cnblogs.com/iron2222/p/15640269.html</span><br><span class="line"></span><br><span class="line">gdb调试器快速上手教程</span><br><span class="line">https://blog.csdn.net/qq_45953886/article/details/127678876</span><br><span class="line"></span><br><span class="line">ARM官方汇编指令</span><br><span class="line">https://blog.csdn.net/oqqHuTu12345678/article/details/125683244</span><br><span class="line"></span><br><span class="line">ARM汇编基础 </span><br><span class="line">https://www.cnblogs.com/hilfloser/p/10516610.html</span><br><span class="line"></span><br><span class="line">ARM关于标志位影响详解</span><br><span class="line">https://blog.csdn.net/tabactivity/article/details/90407858</span><br><span class="line"></span><br><span class="line">ARM的九种寻址方式</span><br><span class="line">https://blog.csdn.net/qq_43743762/article/details/105056991</span><br><span class="line"></span><br><span class="line">### 5.编写第一个汇编程序</span><br><span class="line"></span><br><span class="line">&gt; ​	https://www.w3cschool.cn/c/c-file-io.html</span><br><span class="line"></span><br><span class="line">参考资料:https://softool.cn/read/arm_assembly_basic_aye/21010203.html</span><br><span class="line"></span><br><span class="line">https://blog.csdn.net/qq_41028985/article/details/119407917</span><br><span class="line"></span><br><span class="line">### 6.逆向C程序－数据类型</span><br><span class="line"></span><br><span class="line">&gt; 计算器：</span><br><span class="line">&gt; https://www.bangnishouji.com/tools/224457.html</span><br><span class="line"></span><br><span class="line">##### 1.32位浮点数表示方法:</span><br><span class="line"></span><br><span class="line">&gt; 二进制数怎么转化为浮点数？阶码又是怎么算出来的？</span><br><span class="line">&gt; https://zhidao.baidu.com/question/750285508423217012.html</span><br><span class="line"></span><br><span class="line">算法篇:ios和安卓通用</span><br><span class="line"></span><br><span class="line">参考连接:</span><br><span class="line">https://www.cnblogs.com/xiaxveliang/p/15004954.html</span><br><span class="line">https://blog.csdn.net/sinat_27933301/article/details/79538169</span><br><span class="line">https://www.cnblogs.com/DeeLMind/p/7581423.html</span><br><span class="line">https://www.bilibili.com/video/BV1aP411M7ug:强推</span><br><span class="line"></span><br><span class="line">https://www.bilibili.com/video/BV1V14y1T7LM</span><br><span class="line">https://blog.csdn.net/ZCShouCSDN/article/details/84675235</span><br></pre></td></tr></table></figure>


    </div>

    
    
    
	

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>Topday
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="http://topdayplus.github.io/2024/07/31/Notes-Android/" title="Notes-Android">http://topdayplus.github.io/2024/07/31/Notes-Android/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/Android/" rel="tag"># Android</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/07/03/Notes-Reverse/" rel="prev" title="Notes-Reverse">
                  <i class="fa fa-chevron-left"></i> Notes-Reverse
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/03/08/Notes-Android-II/" rel="next" title="Notes-Android-II">
                  Notes-Android-II <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Topday</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">266k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">4:02</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div><script color="0,0,255" opacity="0.5" zIndex="-1" count="99" src="https://cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js"></script>


    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>


    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
